<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Spatial block cross-validation — part_sblock • flexsdm</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Spatial block cross-validation — part_sblock" />
<meta property="og:description" content="This function explores spatial blocks with different cell sizes and returns the
most suitable size for a given presence or presence-absence database. The selection of the best
grid size is performed automatically considering spatial autocorrelation, environmental
similarity, and the number of presence and absence records in each partition." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flexsdm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/01_pre_modeling.html">1. Overview of Pre-modeling functions</a>
    </li>
    <li>
      <a href="../articles/02_modeling.html">2. Overview of Modeling functions</a>
    </li>
    <li>
      <a href="../articles/03_post_modeling.html">3. Overview of Post-modeling functions</a>
    </li>
    <li>
      <a href="../articles/04_Red_fir_example.html">4. An example with Red Fir</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/sjevelazco/flexsdm/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Spatial block cross-validation</h1>
    <small class="dont-index">Source: <a href='https://github.com/sjevelazco/flexsdm/blob/master/R/part_sblock.R'><code>R/part_sblock.R</code></a></small>
    <div class="hidden name"><code>part_sblock.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function explores spatial blocks with different cell sizes and returns the
most suitable size for a given presence or presence-absence database. The selection of the best
grid size is performed automatically considering spatial autocorrelation, environmental
similarity, and the number of presence and absence records in each partition.</p>
    </div>

    <pre class="usage"><span class='fu'>part_sblock</span><span class='op'>(</span>
  <span class='va'>env_layer</span>,
  <span class='va'>data</span>,
  <span class='va'>x</span>,
  <span class='va'>y</span>,
  <span class='va'>pr_ab</span>,
  n_part <span class='op'>=</span> <span class='fl'>3</span>,
  min_res_mult <span class='op'>=</span> <span class='fl'>3</span>,
  max_res_mult <span class='op'>=</span> <span class='fl'>200</span>,
  num_grids <span class='op'>=</span> <span class='fl'>30</span>,
  min_occ <span class='op'>=</span> <span class='fl'>10</span>,
  prop <span class='op'>=</span> <span class='fl'>0.5</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>env_layer</th>
      <td><p>SpatRaster. Raster with environmental
variable. Used to evaluate spatial autocorrelation and
environmental similarity between training and testing partitions. Because this function
calculate dissimilarity based on Euclidean distances, it can only be used with continuous
environmental variables</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>data.frame. Data.frame or tibble object with presence
(or presence-absence, or presences-pseudo-absence) records, and coordinates</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>character. Column name with spatial x coordinates</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>character. Column name with spatial y coordinates</p></td>
    </tr>
    <tr>
      <th>pr_ab</th>
      <td><p>character. Column with presence, presence-absence,
or pseudo-absence records. Presences must be represented by 1 and absences by 0</p></td>
    </tr>
    <tr>
      <th>n_part</th>
      <td><p>integer. Number of partition. Default 2.</p></td>
    </tr>
    <tr>
      <th>min_res_mult</th>
      <td><p>integer. Minimum value used for multiplying
raster resolution and define the finest resolution to be tested, default 3.</p></td>
    </tr>
    <tr>
      <th>max_res_mult</th>
      <td><p>integer. Maximum value used for multiplying
raster resolution and define the coarsest resolution to be tested, default 200.</p></td>
    </tr>
    <tr>
      <th>num_grids</th>
      <td><p>integer. Number of grid to be tested between
min_res_mult X (raster resolution) and max_res_mult X (raster resolution), default 30</p></td>
    </tr>
    <tr>
      <th>min_occ</th>
      <td><p>numeric. Minimum number of presences or absences in a partition fold.
The min_occ value should be base on the amount of predictors in order to avoid over-fitting
or error when fitting models for a given fold. Default 10.</p></td>
    </tr>
    <tr>
      <th>prop</th>
      <td><p>numeric. Proportion of point used for testing autocorrelation between
groups (values &gt; 0 and &lt;=1). The smaller this proportion is, the faster the function will work.
Default 0.5</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list with:</p><ul>
<li><p>part: A tibble object with information used in 'data' arguments and a additional column
  .part with partition group.</p></li>
<li><p>best_part_info: A tibble with information about the best partition. It contains the
  number of the best partition (n_grid), cell size (cell_size), standard deviation of
  presences (sd_p), standard deviation of absences (sd_a), Moran's I spatial autocorrelation
  (spa_auto), and environmental similarity based on Euclidean distance (env_sim).</p></li>
<li><p>grid: A SpatRaster object with blocks</p></li>
</ul>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The part_sblock allows test with different numbers of partitions using square blocks
(like a checkerboard). This function explores a range of block sizes and automatically selects
the best size for a given given presence, presence-absences, or presence-pseudo-absences
dataset. Number of partition selection is based on an optimization procedure that
explores partition size in three dimensions
determined by spatial autocorrelation (measured by Moran's I), environmental similarity
(Euclidean distance), and difference in the amount of data among partition groups
(Standard Deviation - SD; Velazco et al., 2019). This procedure will iteratively select partitions, first
those partitions with autocorrelation values less than the lowest quartile of Morans I, then
those with environmental similarity values greater than the third quartile of the Euclidean
distances than those with a difference in the amount of data less than the lowest quartile of SD.
This selection is repeated until only one partition is retained (Velazco et al., 2019). The
main benefit of this partition selection are that it i) is not subjective, ii) balances the
environmental similarity and special autocorrelation between partitions, and iii) controls
the selection of partitions with too few data that may be problematic for model fitting
("min_occ" argument).</p>
<p>Geographically structured partitions tend to evaluate model transferability more directly than
conventional ones (e.g., those performed by <code><a href='part_random.html'>part_random</a></code>) (Roberts et al., 2017;
Santini et al., 2021), and are relevant for models that are to be used for projections in other
regions outside the calibration area or for other time periods.</p>
<p>This function can interact with <code><a href='get_block.html'>get_block</a></code>, <code><a href='sample_background.html'>sample_background</a></code>,
and <code><a href='sample_pseudoabs.html'>sample_pseudoabs</a></code> for sampling background points or pseudo-absences within
spatial partition broups</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    
<ul>
<li><p>Roberts, D. R., Bahn, V., Ciuti, S., Boyce, M. S., Elith, J., Guillera-Arroita, G.,
Hauenstein, S., Lahoz-Monfort, J. J., Schroder, B., Thuiller, W., Warton, D. I., Wintle, B. A.,
Hartig, F., &amp; Dormann, C. F. (2017). Cross-validation strategies for data with temporal, spatial,
 hierarchical, or phylogenetic structure. Ecography, 40,
 913-929. https://doi.org/10.1111/ecog.02881</p></li>
<li><p>Santini, L., Benitez-Lopez, A., Maiorano, L., Cengic, M., &amp; Huijbregts, M. A. J. (2021).
 Assessing the reliability of species distribution projections in climate change research.
 Diversity and Distributions, ddi.13252. https://doi.org/10.1111/ddi.13252</p></li>
<li><p>Velazco, S. J. E., Villalobos, F., Galvao, F., &amp; De Marco Junior, P. (2019). A dark
scenario for Cerrado plant species: Effects of future climate, land use and protected areas
ineffectiveness. Diversity and Distributions, 25(4), 660-673. https://doi.org/10.1111/ddi.12886</p></li>
</ul>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='part_random.html'>part_random</a></code>, <code><a href='part_sband.html'>part_sband</a></code>, <code><a href='part_senv.html'>part_senv</a></code>,
<code><a href='get_block.html'>get_block</a></code>, and <code><a href='plot_res.html'>plot_res</a></code>.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://rspatial.org/terra'>terra</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>

<span class='co'># Load datasets</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>spp</span><span class='op'>)</span>
<span class='va'>f</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"external/somevar.tif"</span>, package <span class='op'>=</span> <span class='st'>"flexsdm"</span><span class='op'>)</span>
<span class='va'>somevar</span> <span class='op'>&lt;-</span> <span class='fu'>terra</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/terra/man/rast.html'>rast</a></span><span class='op'>(</span><span class='va'>f</span><span class='op'>)</span>

<span class='co'># Example for one single species</span>
<span class='va'>single_spp</span> <span class='op'>&lt;-</span> <span class='va'>spp</span> <span class='op'>%&gt;%</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>species</span> <span class='op'>==</span> <span class='st'>"sp3"</span><span class='op'>)</span>
<span class='va'>part</span> <span class='op'>&lt;-</span> <span class='fu'>part_sblock</span><span class='op'>(</span>
  env_layer <span class='op'>=</span> <span class='va'>somevar</span>,
  data <span class='op'>=</span> <span class='va'>single_spp</span>,
  x <span class='op'>=</span> <span class='st'>"x"</span>,
  y <span class='op'>=</span> <span class='st'>"y"</span>,
  pr_ab <span class='op'>=</span> <span class='st'>"pr_ab"</span>,
  min_res_mult <span class='op'>=</span> <span class='fl'>10</span>,
  max_res_mult <span class='op'>=</span> <span class='fl'>500</span>,
  num_grids <span class='op'>=</span> <span class='fl'>30</span>,
  n_part <span class='op'>=</span> <span class='fl'>2</span>,
  min_occ <span class='op'>=</span> <span class='fl'>5</span>,
  prop <span class='op'>=</span> <span class='fl'>0.5</span>
<span class='op'>)</span>
<span class='va'>part</span>

<span class='va'>part</span><span class='op'>$</span><span class='va'>part</span> <span class='co'># database with partition fold (.part)</span>
<span class='va'>part</span><span class='op'>$</span><span class='va'>part</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>pr_ab</span>, <span class='va'>.part</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='op'>)</span> <span class='co'># number of presences and absences in each fold</span>
<span class='va'>part</span><span class='op'>$</span><span class='va'>best_part_info</span> <span class='co'># information of the best partition</span>
<span class='va'>part</span><span class='op'>$</span><span class='va'>grid</span> <span class='co'># raster with folds</span>

<span class='co'># Explore the Grid object</span>

<span class='fu'><a href='https://rdrr.io/pkg/terra/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>part</span><span class='op'>$</span><span class='va'>grid</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/terra/man/lines.html'>points</a></span><span class='op'>(</span><span class='va'>part</span><span class='op'>$</span><span class='va'>part</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/pkg/terra/man/c.html'>c</a></span><span class='op'>(</span><span class='st'>"x"</span>, <span class='st'>"y"</span><span class='op'>)</span><span class='op'>]</span>,
  col <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/terra/man/c.html'>c</a></span><span class='op'>(</span><span class='st'>"blue"</span>, <span class='st'>"red"</span><span class='op'>)</span><span class='op'>[</span><span class='va'>part</span><span class='op'>$</span><span class='va'>part</span><span class='op'>$</span><span class='va'>.part</span><span class='op'>]</span>,
  cex <span class='op'>=</span> <span class='fl'>0.5</span>,
  pch <span class='op'>=</span> <span class='fl'>19</span>
<span class='op'>)</span>

<span class='fu'>terra</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/terra/man/dimensions.html'>res</a></span><span class='op'>(</span><span class='va'>part</span><span class='op'>$</span><span class='va'>grid</span><span class='op'>)</span>
<span class='fu'>terra</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/terra/man/dimensions.html'>res</a></span><span class='op'>(</span><span class='va'>somevar</span><span class='op'>)</span>

<span class='co'># Note that this is a layer with block partition, but it has a</span>
<span class='co'># different resolution than the original environmental variables.</span>
<span class='co'># If you wish have a layer with the same properties</span>
<span class='co'># (i.e. resolution, extent, NAs) as your original environmental</span>
<span class='co'># variables you can use the \code{\link{get_block}} function.</span>

<span class='va'>grid_env</span> <span class='op'>&lt;-</span> <span class='fu'><a href='get_block.html'>get_block</a></span><span class='op'>(</span>env_layer <span class='op'>=</span> <span class='va'>somevar</span>, best_grid <span class='op'>=</span> <span class='va'>part</span><span class='op'>$</span><span class='va'>grid</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/pkg/terra/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>grid_env</span><span class='op'>)</span> <span class='co'># this is a block layer with the same layer</span>
<span class='co'># properties as environmental variables.</span>
<span class='fu'><a href='https://rdrr.io/pkg/terra/man/lines.html'>points</a></span><span class='op'>(</span><span class='va'>part</span><span class='op'>$</span><span class='va'>part</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/pkg/terra/man/c.html'>c</a></span><span class='op'>(</span><span class='st'>"x"</span>, <span class='st'>"y"</span><span class='op'>)</span><span class='op'>]</span>,
  col <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/terra/man/c.html'>c</a></span><span class='op'>(</span><span class='st'>"blue"</span>, <span class='st'>"red"</span><span class='op'>)</span><span class='op'>[</span><span class='va'>part</span><span class='op'>$</span><span class='va'>part</span><span class='op'>$</span><span class='va'>.part</span><span class='op'>]</span>,
  cex <span class='op'>=</span> <span class='fl'>0.5</span>,
  pch <span class='op'>=</span> <span class='fl'>19</span>
<span class='op'>)</span>
<span class='co'># This layer is very useful if you need to sample</span>
<span class='co'># pseudo_absence or background point</span>
<span class='co'># See examples in \code{\link{backgroudp}} and \code{\link{pseudoabs}}</span>


<span class='co'># Example of a higher number of partitions</span>
<span class='va'>part</span> <span class='op'>&lt;-</span> <span class='fu'>part_sblock</span><span class='op'>(</span>
  env_layer <span class='op'>=</span> <span class='va'>somevar</span>,
  data <span class='op'>=</span> <span class='va'>single_spp</span>,
  x <span class='op'>=</span> <span class='st'>"x"</span>,
  y <span class='op'>=</span> <span class='st'>"y"</span>,
  pr_ab <span class='op'>=</span> <span class='st'>"pr_ab"</span>,
  min_res_mult <span class='op'>=</span> <span class='fl'>10</span>,
  max_res_mult <span class='op'>=</span> <span class='fl'>500</span>,
  num_grids <span class='op'>=</span> <span class='fl'>30</span>,
  n_part <span class='op'>=</span> <span class='fl'>4</span>,
  min_occ <span class='op'>=</span> <span class='fl'>2</span>,
  prop <span class='op'>=</span> <span class='fl'>0.5</span>
<span class='op'>)</span>

<span class='co'># Explore the Grid object</span>
<span class='fu'><a href='https://rdrr.io/pkg/terra/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>part</span><span class='op'>$</span><span class='va'>grid</span>, col <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/gray.colors.html'>gray.colors</a></span><span class='op'>(</span><span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/terra/man/lines.html'>points</a></span><span class='op'>(</span><span class='va'>part</span><span class='op'>$</span><span class='va'>part</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/pkg/terra/man/c.html'>c</a></span><span class='op'>(</span><span class='st'>"x"</span>, <span class='st'>"y"</span><span class='op'>)</span><span class='op'>]</span>,
  col <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>rainbow</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span><span class='op'>[</span><span class='va'>part</span><span class='op'>$</span><span class='va'>part</span><span class='op'>$</span><span class='va'>.part</span><span class='op'>]</span>,
  cex <span class='op'>=</span> <span class='fl'>0.5</span>,
  pch <span class='op'>=</span> <span class='fl'>19</span>
<span class='op'>)</span>


<span class='co'># Using these functions with several species</span>
<span class='va'>spp2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/terra/man/split.html'>split</a></span><span class='op'>(</span><span class='va'>spp</span>, <span class='va'>spp</span><span class='op'>$</span><span class='va'>species</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>spp2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/terra/man/dimensions.html'>length</a></span><span class='op'>(</span><span class='va'>spp2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/terra/man/names.html'>names</a></span><span class='op'>(</span><span class='va'>spp2</span><span class='op'>)</span>

<span class='va'>part_list</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>spp2</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>result</span> <span class='op'>&lt;-</span> <span class='fu'>part_sblock</span><span class='op'>(</span>
    env_layer <span class='op'>=</span> <span class='va'>somevar</span>,
    data <span class='op'>=</span> <span class='va'>x</span>,
    x <span class='op'>=</span> <span class='st'>"x"</span>,
    y <span class='op'>=</span> <span class='st'>"y"</span>,
    pr_ab <span class='op'>=</span> <span class='st'>"pr_ab"</span>,
    min_res_mult <span class='op'>=</span> <span class='fl'>10</span>,
    max_res_mult <span class='op'>=</span> <span class='fl'>500</span>,
    num_grids <span class='op'>=</span> <span class='fl'>30</span>,
    n_part <span class='op'>=</span> <span class='fl'>2</span>,
    prop <span class='op'>=</span> <span class='fl'>0.5</span>
  <span class='op'>)</span>
  <span class='va'>result</span>
<span class='op'>}</span><span class='op'>)</span>

<span class='va'>part_list</span><span class='op'>$</span><span class='va'>sp3</span> <span class='co'># For this dataset a suitable partition was not found</span>

<span class='co'># Create a single database for all species</span>
<span class='va'>occ_part</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>part_list</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/pkg/terra/man/dimensions.html'>length</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>x</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>
  <span class='op'>}</span>
<span class='op'>}</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind.html'>bind_rows</a></span><span class='op'>(</span>.id <span class='op'>=</span> <span class='st'>"species"</span><span class='op'>)</span>
<span class='va'>occ_part</span>

<span class='co'># Get the best grid info for all species</span>
<span class='va'>grid_info</span> <span class='op'>&lt;-</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind.html'>bind_rows</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span>
  <span class='va'>part_list</span>,
  <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='va'>x</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span>
<span class='op'>)</span>, .id <span class='op'>=</span> <span class='st'>"species"</span><span class='op'>)</span>

<span class='co'># Get the best grid layer for all species</span>
<span class='va'>grid_layer</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>part_list</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='va'>x</span><span class='op'>$</span><span class='va'>grid</span><span class='op'>)</span>
<span class='va'>grid_layer2</span> <span class='op'>&lt;-</span>
  <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='va'>grid_layer</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='fu'><a href='get_block.html'>get_block</a></span><span class='op'>(</span>env_layer <span class='op'>=</span> <span class='va'>somevar</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>, best_grid <span class='op'>=</span> <span class='va'>x</span><span class='op'>)</span>
  <span class='op'>}</span><span class='op'>)</span>
<span class='va'>grid_layer2</span> <span class='op'>&lt;-</span> <span class='fu'>terra</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/terra/man/rast.html'>rast</a></span><span class='op'>(</span><span class='va'>grid_layer2</span><span class='op'>)</span>
<span class='va'>grid_layer2</span>
<span class='fu'><a href='https://rdrr.io/pkg/terra/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>grid_layer2</span><span class='op'>)</span>


<span class='co'># Block partition for presences-only database</span>
<span class='va'>single_spp</span> <span class='op'>&lt;-</span> <span class='va'>spp</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>species</span> <span class='op'>==</span> <span class='st'>"sp1"</span>, <span class='va'>pr_ab</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='va'>single_spp</span>
<span class='va'>single_spp</span><span class='op'>$</span><span class='va'>pr_ab</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/pkg/terra/man/unique.html'>unique</a></span><span class='op'>(</span><span class='op'>)</span> <span class='co'># only presences</span>

<span class='va'>part</span> <span class='op'>&lt;-</span> <span class='fu'>part_sblock</span><span class='op'>(</span>
  env_layer <span class='op'>=</span> <span class='va'>somevar</span>,
  data <span class='op'>=</span> <span class='va'>single_spp</span>,
  x <span class='op'>=</span> <span class='st'>"x"</span>,
  y <span class='op'>=</span> <span class='st'>"y"</span>,
  pr_ab <span class='op'>=</span> <span class='st'>"pr_ab"</span>,
  min_res_mult <span class='op'>=</span> <span class='fl'>10</span>,
  max_res_mult <span class='op'>=</span> <span class='fl'>500</span>,
  num_grids <span class='op'>=</span> <span class='fl'>30</span>,
  n_part <span class='op'>=</span> <span class='fl'>2</span>,
  min_occ <span class='op'>=</span> <span class='fl'>10</span>,
  prop <span class='op'>=</span> <span class='fl'>0.5</span>
<span class='op'>)</span>

<span class='va'>part</span><span class='op'>$</span><span class='va'>part</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/pkg/terra/man/dimensions.html'>dim</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>part</span><span class='op'>$</span><span class='va'>best_part_info</span>
<span class='va'>part</span><span class='op'>$</span><span class='va'>grid</span>

<span class='fu'><a href='https://rdrr.io/pkg/terra/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>part</span><span class='op'>$</span><span class='va'>grid</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/terra/man/lines.html'>points</a></span><span class='op'>(</span>
  <span class='va'>part</span><span class='op'>$</span><span class='va'>part</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/pkg/terra/man/c.html'>c</a></span><span class='op'>(</span><span class='st'>"x"</span>, <span class='st'>"y"</span><span class='op'>)</span><span class='op'>]</span>,
  col <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/terra/man/c.html'>c</a></span><span class='op'>(</span><span class='st'>"blue"</span>, <span class='st'>"red"</span><span class='op'>)</span><span class='op'>[</span><span class='va'>part</span><span class='op'>$</span><span class='va'>part</span><span class='op'>$</span><span class='va'>.part</span><span class='op'>]</span>,
  cex <span class='op'>=</span> <span class='fl'>0.5</span>,
  pch <span class='op'>=</span> <span class='fl'>19</span>
<span class='op'>)</span>
<span class='op'>}</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Santiago J.E. Velazco, Brooke Rose, André F.A. Andrade, Ignacio Minoli, Janet Franklin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


