<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Perform environmental filtering on species occurrences — occfilt_env • flexsdm</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Perform environmental filtering on species occurrences — occfilt_env"><meta property="og:description" content="This function perform filtering on species occurrences based on their environmental conditions."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flexsdm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/v01_pre_modeling.html">1. Overview of Pre-modeling functions</a>
    </li>
    <li>
      <a href="../articles/v02_modeling.html">2. Overview of Modeling functions</a>
    </li>
    <li>
      <a href="../articles/v03_post_modeling.html">3. Overview of Post-modeling functions</a>
    </li>
    <li>
      <a href="../articles/v04_Red_fir_example.html">4. An example with Red Fir</a>
    </li>
    <li>
      <a href="../articles/v05_Rare_species_example.html">5. Modeling a rare species</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/sjevelazco/flexsdm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Perform environmental filtering on species occurrences</h1>
    <small class="dont-index">Source: <a href="https://github.com/sjevelazco/flexsdm/blob/HEAD/R/occfilt_env.R" class="external-link"><code>R/occfilt_env.R</code></a></small>
    <div class="hidden name"><code>occfilt_env.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function perform filtering on species occurrences based on their environmental conditions.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">occfilt_env</span><span class="op">(</span><span class="va">data</span>, <span class="va">x</span>, <span class="va">y</span>, <span class="va">id</span>, <span class="va">env_layer</span>, <span class="va">nbins</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data</dt>
<dd><p>data.frame. Data.frame or tibble object with presences
(or presence-absence) records, and coordinates</p></dd>
<dt>x</dt>
<dd><p>character. Column name with spatial x coordinates</p></dd>
<dt>y</dt>
<dd><p>character. Column name with spatial y coordinates</p></dd>
<dt>id</dt>
<dd><p>character. Column names with rows id. It is important that each row has its own unique code.</p></dd>
<dt>env_layer</dt>
<dd><p>SpatRaster. Rasters with environmental conditions</p></dd>
<dt>nbins</dt>
<dd><p>integer. A number of classes used to split each environmental condition</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A tibble object with data environmentally filtered</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function uses an approach adapted from the approach proposed by Varela et al. (2014).
 It consists of filtering occurrences in  environmental space. First, a regular
 multidimensional grid is created in  environmental space. This multidimensional
 grid is determined by the environmental variables (always use continuous variables) the
 grid cell size is defined by the number of bins, used for dividing variable range into
 interval classes (Varela et al. 2014; Castellanos et al., 2019). The number of bins is set in
 the "nbins" argument. Then, a single occurrence is randomly selected within each cell of the
 multidimensional grid. Consider that there is a trade-off between the number of bins and the number
 of filtered records because as the number of bins decreases, the cell size of the grids
 increases, and the number of filtered records decreases (Castellanos et al., 2019).
 occfilt_env works for any number of dimensions (variables) and with the original variables
 without performing
 a PCA beforehand.</p>
<p>The greater the number of predictor variables (i.e., the number of dimensions of the
 multidimensional environmental grid) and the greater the number of bins, the greater the time processing
 and the computer memory used. Therefore, it is recommended to use a small number of bins
 between 2-5 if more than ten variables are used.</p>
<p>Environmental filters are sensitive to the number of bins. A procedure for selecting the number
 of bins was used by Velazco et al. (2020). This selection consists of testing different numbers
 of bins, calculating the average spatial autocorrelation among variables (based on the
 Moran’s I index), and then selecting the lowest average spatial autocorrelation with the
 highest number occurrences. Note that while the greater the number of bins, the greater
 records retained</p>
    </div>
    <div id="references">
    <h2>References</h2>
    
<ul><li><p>Castellanos, A. A., Huntley, J. W., Voelker, G., &amp; Lawing, A. M. (2019). Environmental
filtering improves ecological niche models across multiple scales. Methods in Ecology and
Evolution, 10(4), 481-492. https://doi.org/10.1111/2041-210X.13142</p></li>
<li><p>Varela, S., Anderson, R. P., Garcia-Valdes, R., &amp; Fernandez-Gonzalez, F. (2014).
Environmental filters reduce the effects of sampling bias and improve predictions of
ecological niche models. Ecography, 37, 1084-1091.
https://doi.org/10.1111/j.1600-0587.2013.00441.x</p></li>
<li><p>Velazco, S. J. E., Svenning, J-C., Ribeiro, B. R., &amp; Laureto, L. M. O. (2020). On
opportunities and threats to conserve the phylogenetic diversity of Neotropical palms.
Diversity and Distributions, 27, 512–523. https://doi.org/10.1111/ddi.13215</p></li>
</ul></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="occfilt_geo.html">occfilt_geo</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra/" class="external-link">terra</a></span><span class="op">)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Environmental variables</span></span>
<span class="r-in"><span class="va">somevar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"external/somevar.tif"</span>, package <span class="op">=</span> <span class="st">"flexsdm"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">somevar</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Species occurrences</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"spp"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">spp</span></span>
<span class="r-in"><span class="va">spp1</span> <span class="op">&lt;-</span> <span class="va">spp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"sp1"</span>, <span class="va">pr_ab</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">somevar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">spp1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">spp1</span><span class="op">$</span><span class="va">idd</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">spp1</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># split environmental variables into 5 bins</span></span>
<span class="r-in"><span class="va">filtered_1</span> <span class="op">&lt;-</span> <span class="fu">occfilt_env</span><span class="op">(</span></span>
<span class="r-in">  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span class="r-in">  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span class="r-in">  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span class="r-in">  id <span class="op">=</span> <span class="st">"idd"</span>,</span>
<span class="r-in">  env_layer <span class="op">=</span> <span class="va">somevar</span>,</span>
<span class="r-in">  nbins <span class="op">=</span> <span class="fl">5</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># split into 8 bins</span></span>
<span class="r-in"><span class="va">filtered_2</span> <span class="op">&lt;-</span> <span class="fu">occfilt_env</span><span class="op">(</span></span>
<span class="r-in">  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span class="r-in">  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span class="r-in">  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span class="r-in">  id <span class="op">=</span> <span class="st">"idd"</span>,</span>
<span class="r-in">  env_layer <span class="op">=</span> <span class="va">somevar</span>,</span>
<span class="r-in">  nbins <span class="op">=</span> <span class="fl">8</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># split into 12 bins</span></span>
<span class="r-in"><span class="va">filtered_3</span> <span class="op">&lt;-</span> <span class="fu">occfilt_env</span><span class="op">(</span></span>
<span class="r-in">  data <span class="op">=</span> <span class="va">spp1</span>,</span>
<span class="r-in">  x <span class="op">=</span> <span class="st">"x"</span>,</span>
<span class="r-in">  y <span class="op">=</span> <span class="st">"y"</span>,</span>
<span class="r-in">  id <span class="op">=</span> <span class="st">"idd"</span>,</span>
<span class="r-in">  env_layer <span class="op">=</span> <span class="va">somevar</span>,</span>
<span class="r-in">  nbins <span class="op">=</span> <span class="fl">12</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="co"># note that the higher the nbins parameter the more</span></span>
<span class="r-in"><span class="co"># classes must be processed (4 variables, 30 bins = 923521 classes)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># While the greater the greater the number of bins, the greater records retained</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Santiago J.E. Velazco, Brooke Rose, André F.A. Andrade,
Ignacio Minoli, Janet Franklin.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

