<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Model assemble and validation — fit_ensemble • flexsdm</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Model assemble and validation — fit_ensemble" />
<meta property="og:description" content="Model assemble and validation" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flexsdm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/01_pre_modeling.html">1. Overview of Pre-modeling functions</a>
    </li>
    <li>
      <a href="../articles/02_modeling.html">2. Overview of Modeling functions</a>
    </li>
    <li>
      <a href="../articles/03_post_modeling.html">3. Overview of Post-modeling functions</a>
    </li>
    <li>
      <a href="../articles/04_Red_fir_example.html">4. An example with Red Fir</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Model assemble and validation</h1>
    
    <div class="hidden name"><code>fit_ensemble.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Model assemble and validation</p>
    </div>

    <pre class="usage"><span class='fu'>fit_ensemble</span><span class='op'>(</span>
  <span class='va'>models</span>,
  ens_method <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/terra/man/c.html'>c</a></span><span class='op'>(</span><span class='st'>"mean"</span>, <span class='st'>"meanw"</span>, <span class='st'>"meansup"</span>, <span class='st'>"meanthr"</span>, <span class='st'>"median"</span><span class='op'>)</span>,
  thr <span class='op'>=</span> <span class='cn'>NULL</span>,
  thr_model <span class='op'>=</span> <span class='cn'>NULL</span>,
  metric <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>models</th>
      <td><p>list. A list of models fitted with fit_ or tune_ function family. Models used for ensemble must have the same presences-absences records, partition methods, threshold types.</p></td>
    </tr>
    <tr>
      <th>ens_method</th>
      <td><p>character. Method used to ensemble different models. A vector must be provided for this argument. For meansup, meanw or pcasup method, it is necessary to provide an evaluation metric and threshold in 'metric' and 'thr_model' arguments respectively . By default will be performed all ensemble methods:</p><ul>
<li><p>mean: Simple average of the different models.</p></li>
<li><p>meanw: Weighted average of models based on their performance. An evaluation metric and threshold type must be provided..</p></li>
<li><p>meansup: Average of the best models (e.g., TSS over the average). An evaluation metric must be provided.</p></li>
<li><p>meanthr: Average performed only with those cells with suitability values above the selected threshold.</p></li>
<li><p>median: Median of the different models.</p></li>
</ul><p>Usage ensemble = "meanthr". In case is needed perform different ensemble method it is necessary concatenate them, e.g., ensemble = c("meanw", "meanthr", "median")</p></td>
    </tr>
    <tr>
      <th>thr</th>
      <td><p>character. Threshold used to get binary suitability values (i.e. 0,1). It is useful for threshold-dependent performance metrics. It is possible to use more than one threshold type. It is necessary to provide a vector for this argument. The next threshold area available:</p><ul>
<li><p>lpt: The highest threshold at which there is no omission.</p></li>
<li><p>equal_sens_spec: Threshold at which the sensitivity and specificity are equal.</p></li>
<li><p>max_sens_spec: Threshold at which the sum of the sensitivity and specificity is the highest (aka threshold that maximizes the TSS).</p></li>
<li><p>max_jaccard: The threshold at which Jaccard is the highest.</p></li>
<li><p>max_sorensen: The threshold at which Sorensen is highest.</p></li>
<li><p>max_fpb: The threshold at which FPB is highest.</p></li>
<li><p>sensitivity: Threshold based on a specified sensitivity value.
  Usage thr = c('sensitivity', sens='0.6') or thr = c('sensitivity'). 'sens' refers to sensitivity value. If it is not specified a sensitivity values, function will use by default 0.9</p></li>
</ul><p>In the case of use more than one threshold type it is necessary concatenate threshold types, e.g., thr=c('lpt', 'max_sens_spec', 'max_jaccard'), or thr=c('lpt', 'max_sens_spec', 'sensitivity', sens='0.8'), or thr=c('lpt', 'max_sens_spec', 'sensitivity'). Function will use all thresholds if no threshold is specified</p></td>
    </tr>
    <tr>
      <th>thr_model</th>
      <td><p>character. This threshold is needed for conduct meanw, meandsup, and meanthr ensemble methods. It is mandatory to use only one threshold, and this must be the same threshold used to fit all the models used in the "models" argument. Usage thr_model = 'equal_sens_spec'</p></td>
    </tr>
    <tr>
      <th>metric</th>
      <td><p>character. Performance metric used for selecting the best combination of hyper-parameter values. One of the next metrics can be used SORENSEN, JACCARD, FPB, TSS, KAPPA, AUC, IMAE, and BOYCE. Default TSS. Usage metric = BOYCE</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list object with:</p><ul>
<li><p>models: A list of models used for performing ensemble.</p></li>
<li><p>thr_metric: Threshold and metric specified in the function.</p></li>
<li><p>predictors: A tibble of quantitative (column names with c) and qualitative (column names with f) variables used in each models.</p></li>
<li><p>performance: A tibble with performance metric (see <code><a href='sdm_eval.html'>sdm_eval</a></code>).
Those threshold dependent metrics are calculated based on the threshold specified in thr argument .</p></li>
</ul>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://rspatial.org/terra/'>terra</a></span><span class='op'>)</span>

<span class='co'># Environmental variables</span>
<span class='va'>somevar</span> <span class='op'>&lt;-</span>
  <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"external/somevar.tif"</span>, package <span class='op'>=</span> <span class='st'>"flexsdm"</span><span class='op'>)</span>
<span class='va'>somevar</span> <span class='op'>&lt;-</span> <span class='fu'>terra</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/terra/man/rast.html'>rast</a></span><span class='op'>(</span><span class='va'>somevar</span><span class='op'>)</span>

<span class='co'># Species occurrences</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"spp"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>)</span>
<span class='va'>some_sp</span> <span class='op'>&lt;-</span> <span class='va'>spp</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>species</span> <span class='op'>==</span> <span class='st'>"sp2"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='sdm_extract.html'>sdm_extract</a></span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='va'>.</span>,
    x <span class='op'>=</span> <span class='st'>"x"</span>,
    y <span class='op'>=</span> <span class='st'>"y"</span>,
    env_layer <span class='op'>=</span> <span class='va'>somevar</span>,
    variables <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/terra/man/names.html'>names</a></span><span class='op'>(</span><span class='va'>somevar</span><span class='op'>)</span>,
    filter_na <span class='op'>=</span> <span class='cn'>TRUE</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='part_random.html'>part_random</a></span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='va'>.</span>,
    pr_ab <span class='op'>=</span> <span class='st'>"pr_ab"</span>,
    method <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/terra/man/c.html'>c</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"kfold"</span>, folds <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
  <span class='op'>)</span>


<span class='co'># gam</span>
<span class='va'>mglm</span> <span class='op'>&lt;-</span> <span class='fu'><a href='fit_glm.html'>fit_glm</a></span><span class='op'>(</span>
  data <span class='op'>=</span> <span class='va'>some_sp</span>,
  response <span class='op'>=</span> <span class='st'>"pr_ab"</span>,
  predictors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/terra/man/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CFP_1"</span>, <span class='st'>"CFP_2"</span>, <span class='st'>"CFP_3"</span>, <span class='st'>"CFP_4"</span><span class='op'>)</span>,
  partition <span class='op'>=</span> <span class='st'>".part"</span>,
  poly <span class='op'>=</span> <span class='fl'>2</span>
<span class='op'>)</span>
<span class='va'>mraf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='fit_raf.html'>fit_raf</a></span><span class='op'>(</span>
  data <span class='op'>=</span> <span class='va'>some_sp</span>,
  response <span class='op'>=</span> <span class='st'>"pr_ab"</span>,
  predictors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/terra/man/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CFP_1"</span>, <span class='st'>"CFP_2"</span>, <span class='st'>"CFP_3"</span>, <span class='st'>"CFP_4"</span><span class='op'>)</span>,
  partition <span class='op'>=</span> <span class='st'>".part"</span>,
<span class='op'>)</span>
<span class='va'>mgbm</span> <span class='op'>&lt;-</span> <span class='fu'><a href='fit_gbm.html'>fit_gbm</a></span><span class='op'>(</span>
  data <span class='op'>=</span> <span class='va'>some_sp</span>,
  response <span class='op'>=</span> <span class='st'>"pr_ab"</span>,
  predictors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/terra/man/c.html'>c</a></span><span class='op'>(</span><span class='st'>"CFP_1"</span>, <span class='st'>"CFP_2"</span>, <span class='st'>"CFP_3"</span>, <span class='st'>"CFP_4"</span><span class='op'>)</span>,
  partition <span class='op'>=</span> <span class='st'>".part"</span>
<span class='op'>)</span>

<span class='co'># Fit and validate ensemble model</span>
<span class='va'>mensemble</span> <span class='op'>&lt;-</span> <span class='fu'>fit_ensemble</span><span class='op'>(</span>
  models <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>mglm</span>, <span class='va'>mraf</span>, <span class='va'>mgbm</span><span class='op'>)</span>,
  ens_method <span class='op'>=</span> <span class='st'>"meansup"</span>,
  thr <span class='op'>=</span> <span class='cn'>NULL</span>,
  thr_model <span class='op'>=</span> <span class='st'>"max_sens_spec"</span>,
  metric <span class='op'>=</span> <span class='st'>"TSS"</span>
<span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Santiago J.E. Velazco, André F.A. Andrade, Brooke Rose, Ignacio Minoli, Janet Franklin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


