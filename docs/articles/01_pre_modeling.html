<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>flexsdm: Overview of Pre-modeling functions • flexsdm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="flexsdm: Overview of Pre-modeling functions">
<meta property="og:description" content="flexsdm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flexsdm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01_pre_modeling.html">Overview of Pre-modeling functions</a>
    </li>
    <li>
      <a href="../articles/01_pre_modeling.html">Overview of Modeling functions</a>
    </li>
    <li>
      <a href="../articles/04_Red_fir_example.html">An example with Red Fir</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="01_pre_modeling_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>flexsdm: Overview of Pre-modeling functions</h1>
            
      
      
      <div class="hidden name"><code>01_pre_modeling.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Species distribution modeling (SDM) has become a standard tool in multiple research areas, including ecology, conservation biology, biogeography, paleobiogeography, and epidemiology. SDM is an area of active research in both theoretical and methodological applications. The <em>flexsdm</em> package provides users the ability to manipulate and parameterize models in a variety of ways that meet their unique research needs.</p>
<p>This flexibility enables users to define their own complete or partial modeling procedure specific for their modeling situations (e.g., number of variables, number of records, different algorithms and ensemble methods, algorithms tuning, etc.).</p>
<p>In this vignette, users will learn about the first set of functions in the <em>flexsdm</em> package that fall under the “pre-modeling” umbrella (see below for full list).</p>
<ol style="list-style-type: decimal">
<li>sdm_directory():</li>
<li>calib_area(): Delimit calibration area for constructing species distribution models</li>
<li>correct_colinvar(): Perform collinearity reduction on predictors</li>
<li>env_outliers(): Integration of outliers detection methods in the environmental space</li>
<li>part_classical(): Data partitioning for training and testing models</li>
<li>part_sblock(): Spatial block cross validation</li>
<li>plot_res(): Plot different resolutions to be used in part_sblock</li>
<li>part_senv(): Environmental and spatial cross validation</li>
<li>sample_background(): Sample background points</li>
<li>sample_pseudoabs(): Peseudo-absence allocation method</li>
<li>sdm_extract(): Extract environmental data based on x and y coordinates</li>
<li>occfilt_env(): Perform environmental filtering on species occurrences</li>
<li>occfilt_geo(): Perform geographical filtering on species occurrences</li>
</ol>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>First, let’s install the flexsdm package. You can install the released version of <em>flexsdm</em> from <a href="https://github.com/sjevelazco/flexsdm">github</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#devtools::install_github('sjevelazco/flexsdm')</span></code></pre></div>
</div>
<div id="project-directory-setup" class="section level2">
<h2 class="hasAnchor">
<a href="#project-directory-setup" class="anchor"></a>Project Directory Setup</h2>
<p>When building SDM’s, organizing your folder directories will save time and confusion later. The project directory is the main project folder where you will store all of the relevant data and results for your current project. Now, let’s create a project directory where your initial data and the model results will be stored. The function sdm_directory() can do this for you, based on the types of model algorithms you want to use and/or the types of projections you would like to make. First you want to decide where on your computer you would like to store the inputs and outputs of your project (this will be your main directory) and then use dir.create() to create your main directory. Next, specify whether or not you want to include folders for projections, calibration areas, algorithms, ensembles, and thresholds.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">flexsdm</span><span class="op">)</span>
<span class="va">my_project</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'flex_sdm_project'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="va">my_project</span><span class="op">)</span>

<span class="fu"><a href="../reference/sdm_directory.html">sdm_directory</a></span><span class="op">(</span>main_dir <span class="op">=</span> <span class="va">my_project</span>,
              projections <span class="op">=</span> <span class="cn">NULL</span>,
              calibration_area <span class="op">=</span> <span class="cn">TRUE</span>,
              algorithm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"gam"</span>, <span class="st">"tune_max"</span>, <span class="st">"tune_raf"</span><span class="op">)</span>,
              ensemble <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"mean"</span><span class="op">)</span>,
              threshold <span class="op">=</span> <span class="cn">TRUE</span>, 
              return_vector <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Directories were be created in:</span>
<span class="co">#&gt; C:\Users\santi\AppData\Local\Temp\RtmpIRXWgA/flex_sdm_project</span>
<span class="co">#&gt;  [1] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project"                                             </span>
<span class="co">#&gt;  [2] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/1_Inputs"                                    </span>
<span class="co">#&gt;  [3] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/1_Inputs/1_Occurrences"                      </span>
<span class="co">#&gt;  [4] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/1_Inputs/2_Predictors"                       </span>
<span class="co">#&gt;  [5] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/1_Inputs/2_Predictors/1_Current"             </span>
<span class="co">#&gt;  [6] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/1_Inputs/3_Calibration_area"                 </span>
<span class="co">#&gt;  [7] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/2_Outputs"                                   </span>
<span class="co">#&gt;  [8] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/2_Outputs/0_Model_performance"               </span>
<span class="co">#&gt;  [9] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/2_Outputs/1_Current"                         </span>
<span class="co">#&gt; [10] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/2_Outputs/1_Current/Algorithm"               </span>
<span class="co">#&gt; [11] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/2_Outputs/1_Current/Algorithm/gam"           </span>
<span class="co">#&gt; [12] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/2_Outputs/1_Current/Algorithm/gam/1_con"     </span>
<span class="co">#&gt; [13] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/2_Outputs/1_Current/Algorithm/gam/2_bin"     </span>
<span class="co">#&gt; [14] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/2_Outputs/1_Current/Algorithm/tune_max"      </span>
<span class="co">#&gt; [15] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/2_Outputs/1_Current/Algorithm/tune_max/1_con"</span>
<span class="co">#&gt; [16] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/2_Outputs/1_Current/Algorithm/tune_max/2_bin"</span>
<span class="co">#&gt; [17] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/2_Outputs/1_Current/Algorithm/tune_raf"      </span>
<span class="co">#&gt; [18] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/2_Outputs/1_Current/Algorithm/tune_raf/1_con"</span>
<span class="co">#&gt; [19] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/2_Outputs/1_Current/Algorithm/tune_raf/2_bin"</span>
<span class="co">#&gt; [20] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/2_Outputs/1_Current/Ensemble"                </span>
<span class="co">#&gt; [21] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/2_Outputs/1_Current/Ensemble/mean"           </span>
<span class="co">#&gt; [22] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/2_Outputs/1_Current/Ensemble/mean/1_con"     </span>
<span class="co">#&gt; [23] "C:\\Users\\santi\\AppData\\Local\\Temp\\RtmpIRXWgA/flex_sdm_project/2_Outputs/1_Current/Ensemble/mean/2_bin"</span></code></pre></div>
</div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>In this tutorial, we will be using species occurrences and environmental data that are available through the <em>flexsdm</em> package. However, if you want to use your own data, be sure to add your species occurrence data (example: csv file) and your environmental predictors (example: .tif or .asc files) to the “1_Input” folder you just created.</p>
<div id="species-occurrence-data" class="section level3">
<h3 class="hasAnchor">
<a href="#species-occurrence-data" class="anchor"></a>Species occurrence data</h3>
<p>The “spp” example dataset includes presence (1) and absence (0) location (x, y) data for 3 plant species found in California. You can load the spp data into your local R environment by using the code below:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">spp</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html">head</a></span><span class="op">(</span><span class="va">spp</span><span class="op">)</span>, align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">'l'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">species</th>
<th align="left">x</th>
<th align="left">y</th>
<th align="left">pr_ab</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">sp1</td>
<td align="left">-5540.836</td>
<td align="left">-145138.33</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">sp1</td>
<td align="left">-51980.836</td>
<td align="left">16321.67</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">sp1</td>
<td align="left">-269870.836</td>
<td align="left">69511.67</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">sp1</td>
<td align="left">-96260.836</td>
<td align="left">-32008.33</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">sp1</td>
<td align="left">269589.164</td>
<td align="left">-566338.33</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">sp1</td>
<td align="left">29829.164</td>
<td align="left">-328468.33</td>
<td align="left">0</td>
</tr>
</tbody>
</table>
</div>
<div id="environmental-predictors" class="section level3">
<h3 class="hasAnchor">
<a href="#environmental-predictors" class="anchor"></a>Environmental predictors</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">somevar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"external/somevar.tif"</span>, package <span class="op">=</span> <span class="st">"flexsdm"</span><span class="op">)</span>
<span class="va">somevar</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html">rast</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span></code></pre></div>
<p><img src="01_pre_modeling_files/figure-html/env%20data-1.png" width="576"></p>
<p>How are the points distributed across our study area?</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html">points</a></span><span class="op">(</span><span class="va">spp</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.3</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">spp</span><span class="op">$</span><span class="va">species</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="01_pre_modeling_files/figure-html/map-1.png" width="576"></p>
</div>
</div>
<div id="calibration-area" class="section level2">
<h2 class="hasAnchor">
<a href="#calibration-area" class="anchor"></a>Calibration area</h2>
<p>A big decision in SDM is delimiting your model’s calibration area, or the geographic space you will use to train your model(s). Choice of calibration area affects other modeling steps, including sampling pseudo-absence and background points, performance metrics, and the geographic patterns of habitat suitability. You would not want to train an SDM using the extent of the United States if you are interested in the geographic distribution and environmental controls of a rare plant species that is only found on mountaintops in the Sierra Nevada!</p>
<p>Let’s use presence locations for one species in this exercise.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">single_spp</span> <span class="op">&lt;-</span>
  <span class="va">spp</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"sp1"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">pr_ab</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">pr_ab</span><span class="op">)</span></code></pre></div>
<p>The calib_area() function offers three methods for defining calibration area: buffer, mcp, bmcp, and mask. We will briefly go over each.</p>
<div id="buffer" class="section level3">
<h3 class="hasAnchor">
<a href="#buffer" class="anchor"></a>1. Buffer</h3>
<p>Here we define the calibration area using buffers around presence points. User’s can specify the distance around points using the “width” argument.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ca_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calib_area.html">calib_area</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">single_spp</span>,
  x <span class="op">=</span> <span class="st">"x"</span>,
  y <span class="op">=</span> <span class="st">"y"</span>,
  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"buffer"</span>, width <span class="op">=</span> <span class="fl">40000</span><span class="op">)</span>,
<span class="op">)</span>
<span class="co">#&gt; Loading required namespace: rgeos</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">ca_1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html">points</a></span><span class="op">(</span><span class="va">single_spp</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="01_pre_modeling_files/figure-html/buffer%20method-1.png" width="576"></p>
</div>
<div id="minimum-convex-polygon" class="section level3">
<h3 class="hasAnchor">
<a href="#minimum-convex-polygon" class="anchor"></a>2. Minimum convex polygon</h3>
<p>You can see that the minimum convex polygon (mcp) method produces a much simpler shape.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ca_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calib_area.html">calib_area</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">single_spp</span>,
  x <span class="op">=</span> <span class="st">"x"</span>,
  y <span class="op">=</span> <span class="st">"y"</span>,
  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"mcp"</span><span class="op">)</span>,
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">ca_2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html">points</a></span><span class="op">(</span><span class="va">single_spp</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="01_pre_modeling_files/figure-html/mcp%20method-1.png" width="576"></p>
</div>
<div id="buffered-minimum-convex-polygon" class="section level3">
<h3 class="hasAnchor">
<a href="#buffered-minimum-convex-polygon" class="anchor"></a>3. Buffered minimum convex polygon</h3>
<p>You can also create a buffer around the minimum convex polygon.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ca_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calib_area.html">calib_area</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">single_spp</span>,
  x <span class="op">=</span> <span class="st">"x"</span>,
  y <span class="op">=</span> <span class="st">"y"</span>,
  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"bmcp"</span>, width <span class="op">=</span> <span class="fl">40000</span><span class="op">)</span>,
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">ca_3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html">points</a></span><span class="op">(</span><span class="va">single_spp</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="01_pre_modeling_files/figure-html/bmcp%20method-1.png" width="576"></p>
</div>
<div id="mask" class="section level3">
<h3 class="hasAnchor">
<a href="#mask" class="anchor"></a>4. Mask</h3>
<p>The mask method allows you to select polygons that intersect with your species locations to delineate your calibration area. This might be useful if you are dealing with ecologically significant ecoregions or are interested in distributions within political boundaries. We will use a random set of polygons named “clusters” to illustrate the mask method. The original polygons are on the left and the polygons that contain points (our “mask” calibration area) are on the right.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"external/clusters.shp"</span>, package <span class="op">=</span> <span class="st">"flexsdm"</span><span class="op">)</span>
<span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html">vect</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span>

<span class="va">ca_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calib_area.html">calib_area</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">single_spp</span>,
  x <span class="op">=</span> <span class="st">"x"</span>,
  y <span class="op">=</span> <span class="st">"y"</span>,
  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"mask"</span>, <span class="va">clusters</span>, <span class="st">"clusters"</span><span class="op">)</span>,
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html">plot</a></span><span class="op">(</span><span class="va">ca_4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html">points</a></span><span class="op">(</span><span class="va">single_spp</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p><img src="01_pre_modeling_files/figure-html/mask%20method-1.png" width="576"></p>
</div>
</div>
<div id="reducing-collinearity-among-the-predictors" class="section level2">
<h2 class="hasAnchor">
<a href="#reducing-collinearity-among-the-predictors" class="anchor"></a>Reducing collinearity among the predictors</h2>
<p>Predictor collinearity is a common issue for SDMs, which can lead to model overfitting and errors in the estimative power of predictors (De Marco &amp; Nóbrega, 2018; Dormann et al., 2013). This can be visualized with the pairs() function from the <em>terra</em> package. Several of our variables have pretty high collinearity (.89 for predictors CFP_3 and CFP_4)!</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/pairs.html">pairs</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span></code></pre></div>
<p><img src="01_pre_modeling_files/figure-html/pairs%20plot-1.png" width="576"></p>
<p>So how can we correct for or reduce this collinearity? The function correct_colinvar() has four methods to deal with collinearity: pearson, vif, pca, and fa. Each method returns 1) a raster object (SpatRaster) with the selected predictors and 2) other useful outputs relevant to each method. Let’s look at each method:</p>
<div id="pearson-correlation" class="section level3">
<h3 class="hasAnchor">
<a href="#pearson-correlation" class="anchor"></a>1. Pearson correlation</h3>
<p>This method eliminates predictors with a Pearson correlation index higher than a determined threshold. The default threshold is 0.7, but users can specify a given threshold (x) with method = c(‘pearson’, th = ‘x’). Here, we can see that the “pearson” method retains the first two predictors (CFP_1 and CFP_2) and removes the second two (CFP_3 and CFP_4).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pearson_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/correct_colinvar.html">correct_colinvar</a></span><span class="op">(</span><span class="va">somevar</span>, method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"pearson"</span>, th<span class="op">=</span><span class="st">"0.7"</span><span class="op">)</span><span class="op">)</span>
<span class="va">pearson_var</span><span class="op">$</span><span class="va">env_layer</span>
<span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 558, 394, 2  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 1890, 1890  (x, y)</span>
<span class="co">#&gt; extent      : -373685.8, 370974.2, -604813.3, 449806.7  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=aea +lat_0=0 +lon_0=-120 +lat_1=34 +lat_2=40.5 +x_0=0 +y_0=-4000000 +datum=NAD83 +units=m +no_defs </span>
<span class="co">#&gt; source      : somevar.tif </span>
<span class="co">#&gt; names       :     CFP_1,     CFP_2 </span>
<span class="co">#&gt; min values  :  77.20633,   0.00000 </span>
<span class="co">#&gt; max values  :  772.8461, 1357.8647</span>
<span class="va">pearson_var</span><span class="op">$</span><span class="va">removed_variables</span>
<span class="co">#&gt; [1] "CFP_3" "CFP_4"</span>
<span class="va">pearson_var</span><span class="op">$</span><span class="va">correlation_table</span>
<span class="co">#&gt; # A tibble: 4 x 5</span>
<span class="co">#&gt;   variable  CFP_1 CFP_2  CFP_3  CFP_4</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 CFP_1    0      0.506 0.0685 0.0492</span>
<span class="co">#&gt; 2 CFP_2    0.506  0     0.843  0.768 </span>
<span class="co">#&gt; 3 CFP_3    0.0685 0.843 0      0.887 </span>
<span class="co">#&gt; 4 CFP_4    0.0492 0.768 0.887  0</span></code></pre></div>
</div>
<div id="variance-inflation-factor" class="section level3">
<h3 class="hasAnchor">
<a href="#variance-inflation-factor" class="anchor"></a>2. Variance inflation factor</h3>
<p>This method removes the predictors with a higher variance inflation factor than the chosen threshold. Again users can specify a threshold (the default is 10). This method retains the predictors CFP_1, CFP_3, and CFP_4 and removes CFP_2.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vif_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/correct_colinvar.html">correct_colinvar</a></span><span class="op">(</span><span class="va">somevar</span>, method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"vif"</span>, th <span class="op">=</span> <span class="st">"10"</span><span class="op">)</span><span class="op">)</span>
<span class="va">vif_var</span><span class="op">$</span><span class="va">env_layer</span>
<span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 558, 394, 3  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 1890, 1890  (x, y)</span>
<span class="co">#&gt; extent      : -373685.8, 370974.2, -604813.3, 449806.7  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=aea +lat_0=0 +lon_0=-120 +lat_1=34 +lat_2=40.5 +x_0=0 +y_0=-4000000 +datum=NAD83 +units=m +no_defs </span>
<span class="co">#&gt; source      : somevar.tif </span>
<span class="co">#&gt; names       :      CFP_1,      CFP_3,      CFP_4 </span>
<span class="co">#&gt; min values  : 77.2063293, -0.6091755, -9.3948898 </span>
<span class="co">#&gt; max values  :  772.84613,   29.84762,   14.27122</span>
<span class="va">vif_var</span><span class="op">$</span><span class="va">removed_variables</span>
<span class="co">#&gt; [1] "CFP_2"</span>
<span class="va">vif_var</span><span class="op">$</span><span class="va">correlation_table</span>
<span class="co">#&gt; # A tibble: 3 x 4</span>
<span class="co">#&gt;   variable   CFP_1   CFP_3  CFP_4</span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 CFP_1     0      -0.0685 0.0492</span>
<span class="co">#&gt; 2 CFP_3    -0.0685  0      0.887 </span>
<span class="co">#&gt; 3 CFP_4     0.0492  0.887  0</span></code></pre></div>
</div>
<div id="factorial-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#factorial-analysis" class="anchor"></a>3. Factorial analysis</h3>
<p>Selecting the “fa” method performs a factorial analysis to reduce dimensionality and selects the predictor(s) with the highest correlation to each axis. NOT WORKING</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#fa_var &lt;- correct_colinvar(somevar, method = c("fa"))</span>
<span class="co">#fa_var$env_layer</span>
<span class="co">#fa_var$removed_variables</span>
<span class="co">#fa_var$correlation_table</span></code></pre></div>
</div>
<div id="principal-component-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#principal-component-analysis" class="anchor"></a>4. Principal component analysis</h3>
<p>Finally, the “pca” method performs a principal components analysis on the predictors and returns the axis that accounts for 95% of the total variance in the system.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pca_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/correct_colinvar.html">correct_colinvar</a></span><span class="op">(</span><span class="va">somevar</span>, method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"pca"</span><span class="op">)</span><span class="op">)</span>
<span class="va">pca_var</span><span class="op">$</span><span class="va">env_layer</span>
<span class="co">#&gt; class       : SpatRaster </span>
<span class="co">#&gt; dimensions  : 558, 394, 2  (nrow, ncol, nlyr)</span>
<span class="co">#&gt; resolution  : 1890, 1890  (x, y)</span>
<span class="co">#&gt; extent      : -373685.8, 370974.2, -604813.3, 449806.7  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=aea +lat_0=0 +lon_0=-120 +lat_1=34 +lat_2=40.5 +x_0=0 +y_0=-4000000 +datum=NAD83 +units=m +no_defs </span>
<span class="co">#&gt; source      : memory </span>
<span class="co">#&gt; names       :       PC1,       PC2 </span>
<span class="co">#&gt; min values  : -6.436795, -4.089726 </span>
<span class="co">#&gt; max values  :  3.433697,  4.116334</span>
<span class="va">pca_var</span><span class="op">$</span><span class="va">coefficients</span>
<span class="co">#&gt; # A tibble: 4 x 5</span>
<span class="co">#&gt;   variable    PC1    PC2     PC3    PC4</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 CFP_1    -0.178 -0.894  0.124   0.393</span>
<span class="co">#&gt; 2 CFP_2     0.580  0.235  0.0566  0.778</span>
<span class="co">#&gt; 3 CFP_3     0.575 -0.204  0.675  -0.415</span>
<span class="co">#&gt; 4 CFP_4     0.550 -0.324 -0.725  -0.259</span>
<span class="va">pca_var</span><span class="op">$</span><span class="va">cumulative_variance</span>
<span class="co">#&gt; # A tibble: 4 x 2</span>
<span class="co">#&gt;      PC  cvar</span>
<span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1 0.680</span>
<span class="co">#&gt; 2     2 0.964</span>
<span class="co">#&gt; 3     3 0.990</span>
<span class="co">#&gt; 4     4 1</span></code></pre></div>
</div>
</div>
<div id="data-cleaning" class="section level2">
<h2 class="hasAnchor">
<a href="#data-cleaning" class="anchor"></a>Data cleaning</h2>
</div>
<div id="data-partitioning" class="section level2">
<h2 class="hasAnchor">
<a href="#data-partitioning" class="anchor"></a>Data partitioning</h2>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># It will prepared data for modeling a species</span>
<span class="va">occ</span> <span class="op">&lt;-</span> <span class="va">spp</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"sp2"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># filter a species</span>
  <span class="fu"><a href="../reference/sdm_extract.html">sdm_extract</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">.</span>, x <span class="op">=</span> <span class="st">'x'</span>, y <span class="op">=</span> <span class="st">'y'</span>, 
              env_layer <span class="op">=</span> <span class="va">somevar</span>, filter_na <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># extract variables values</span>
  <span class="fu"><a href="../reference/part_random.html">part_random</a></span><span class="op">(</span><span class="va">.</span>,pr_ab <span class="op">=</span> <span class="st">'pr_ab'</span>, 
              method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'kfold'</span>, folds <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="co"># add columns with partition</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Santiago J.E. Velazco, André F.A. Andrade, Brooke Rose, Ignacio Minoli, Janet Franklin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
