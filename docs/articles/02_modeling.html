<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>flexsdm: Overview of Modeling functions • flexsdm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="flexsdm: Overview of Modeling functions">
<meta property="og:description" content="flexsdm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flexsdm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01_pre_modeling.html">1. Overview of Pre-modeling functions</a>
    </li>
    <li>
      <a href="../articles/02_modeling.html">2. Overview of Modeling functions</a>
    </li>
    <li>
      <a href="../articles/03_post_modeling.html">3. Overview of Post-modeling functions</a>
    </li>
    <li>
      <a href="../articles/04_Red_fir_example.html">4. An example with Red Fir</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sjevelazco/flexsdm/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="02_modeling_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>flexsdm: Overview of Modeling functions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sjevelazco/flexsdm/blob/master/vignettes/02_modeling.Rmd"><code>vignettes/02_modeling.Rmd</code></a></small>
      <div class="hidden name"><code>02_modeling.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Species distribution modeling (SDM) has become a standard tool in multiple research areas, including ecology, conservation biology, biogeography, paleobiogeography, and epidemiology. SDM is an area of active theoretical and methodological research. The <em>flexsdm</em> package provides users the ability to manipulate and parameterize models in a variety of ways that meet their unique research needs.</p>
<p>This flexibility enables users to define their own complete or partial modeling procedure specific for their modeling situations (e.g., number of variables, number of records, different algorithms and ensemble methods, algorithms tuning, etc.).</p>
<p>In this vignette, users will learn about the second set of functions in the <em>flexsdm</em> package that fall under the “modeling” umbrella. These functions were designed to construct and validate different types of models and can be grouped into fit_* , tune_* , and esm_* family functions. In addition there is a function to perform ensemble modeling.</p>
<p>The fit_* functions construct and validate models with default hyper-parameter values. The tune_* functions construct and validate models by searching for the best combination of hyper-parameter values, and esm_ functions can be used for constructing and validating Ensemble of Small Models. Finally, the fit_ensemble() function is for fitting and validating ensemble models.</p>
<p>These are the functions for model construction and validation:</p>
<p><strong>fit_* functions family</strong></p>
<ul>
<li><p>fit_gam() Fit and validate Generalized Additive Models</p></li>
<li><p>fit_gau() Fit and validate Gaussian Process models</p></li>
<li><p>fit_gbm() Fit and validate Generalized Boosted Regression models</p></li>
<li><p>fit_glm() Fit and validate Generalized Linear Models</p></li>
<li><p>fit_max() Fit and validate Maximum Entropy models</p></li>
<li><p>fit_net() Fit and validate Neural Networks models</p></li>
<li><p>fit_raf() Fit and validate Random Forest models</p></li>
<li><p>fit_svm() Fit and validate Support Vector Machine models</p></li>
</ul>
<p><strong>tune_* functions family</strong></p>
<ul>
<li><p>tune_gbm() Fit and validate Generalized Boosted Regression models with exploration of hyper-parameters</p></li>
<li><p>tune_max() Fit and validate Maximum Entropy models with exploration of hyper-parameters</p></li>
<li><p>tune_net() Fit and validate Neural Networks models with exploration of hyper-parameters</p></li>
<li><p>tune_raf() Fit and validate Random Forest models with exploration of hyper-parameters</p></li>
<li><p>tune_svm() Fit and validate Support Vector Machine models with exploration of hyper-parameters</p></li>
</ul>
<p><strong>model ensemble</strong></p>
<ul>
<li>fit_ensemble() Fit and validate ensemble models with different ensemble methods</li>
</ul>
<p><strong>esm_* functions family</strong></p>
<ul>
<li><p>esm_gam() Fit and validate Generalized Additive Models with Ensemble of Small Model approach</p></li>
<li><p>esm_gau() Fit and validate Gaussian Process models Models with Ensemble of Small Model approach</p></li>
<li><p>esm_gbm() Fit and validate Generalized Boosted Regression models with Ensemble of Small Model approach</p></li>
<li><p>esm_glm() Fit and validate Generalized Linear Models with Ensemble of Small Model approach</p></li>
<li><p>esm_max() Fit and validate Maximum Entropy models with Ensemble of Small Model approach</p></li>
<li><p>esm_net() Fit and validate Neural Networks models with Ensemble of Small Model approach</p></li>
<li><p>esm_svm() Fit and validate Support Vector Machine models with Ensemble of Small Model approach</p></li>
</ul>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>First, install the flexsdm package. You can install the released version of <em>flexsdm</em> from <a href="https://github.com/sjevelazco/flexsdm">github</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># devtools::install_github('sjevelazco/flexsdm')</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">flexsdm</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: flexsdm</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra/">terra</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: terra</span>
<span class="co">#&gt; terra version 1.5.2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'terra'</span>
<span class="co">#&gt; The following object is masked from 'package:knitr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     spin</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: dplyr</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:terra':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, src, union</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span></code></pre></div>
</div>
<div id="project-directory-setup" class="section level2">
<h2 class="hasAnchor">
<a href="#project-directory-setup" class="anchor"></a>Project directory setup</h2>
<p>Decide where on your computer you would like to store the inputs and outputs of your project (this will be your main directory). Use an existing one or use dir.create() to create your main directory. Then specify whether or not to include folders for projections, calibration areas, algorithms, ensembles, and thresholds. For more details see <a href="https://sjevelazco.github.io/flexsdm/articles/01_pre_modeling.html">Vignette 01_pre_modeling</a></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_project</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"flex_sdm_project"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="va">my_project</span><span class="op">)</span>

<span class="va">project_directory</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sdm_directory.html">sdm_directory</a></span><span class="op">(</span>
  main_dir <span class="op">=</span> <span class="va">my_project</span>,
  projections <span class="op">=</span> <span class="cn">NULL</span>,
  calibration_area <span class="op">=</span> <span class="cn">TRUE</span>,
  algorithm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"fit_max"</span>, <span class="st">"tune_raf"</span><span class="op">)</span>,
  ensemble <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"mean"</span><span class="op">)</span>,
  threshold <span class="op">=</span> <span class="cn">TRUE</span>,
  return_vector <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>
<span class="co">#&gt; Directories were be created in:</span>
<span class="co">#&gt; C:\Users\santi\AppData\Local\Temp\RtmpKSU8rJ/flex_sdm_project</span></code></pre></div>
</div>
<div id="data-species-occurrence-and-background-data" class="section level2">
<h2 class="hasAnchor">
<a href="#data-species-occurrence-and-background-data" class="anchor"></a>Data, species occurrence and background data</h2>
<p>In this tutorial, we will be using species occurrences and environmental data that are available through the <em>flexsdm</em> package. The “abies” example dataset includes a pr_ab column (presence = 1, and absence = 0), location columns (x, y) and other environmental data. You can load the “abies” data into your local R environment by using the code below:</p>
<p>(THIS EXAMPLE LOOKS A LITTLE STRANGE BECAUSE WE ARE ALSO USING BACKGROUND DATA, WHILE THE ABIES DATASET CLEARLY HAS ABSENCES…)</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"abies"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"backg"</span><span class="op">)</span>

<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">abies</span><span class="op">)</span>
<span class="co">#&gt; Rows: 1,400</span>
<span class="co">#&gt; Columns: 13</span>
<span class="co">#&gt; $ id       &lt;int&gt; 715, 5680, 7907, 1850, 1702, 10036, 12384, 6513, 9884, 8651, ~</span>
<span class="co">#&gt; $ pr_ab    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~</span>
<span class="co">#&gt; $ x        &lt;dbl&gt; -95417.134, 98986.536, 121474.257, -39976.221, 111372.261, -2~</span>
<span class="co">#&gt; $ y        &lt;dbl&gt; 314240.13, -159415.18, -99463.44, -17456.11, -91404.05, 39222~</span>
<span class="co">#&gt; $ aet      &lt;dbl&gt; 323.1133, 447.5567, 182.2833, 372.3867, 209.4567, 308.3000, 5~</span>
<span class="co">#&gt; $ cwd      &lt;dbl&gt; 546.1400, 815.4033, 271.1800, 946.2933, 398.5500, 534.9533, 3~</span>
<span class="co">#&gt; $ tmin     &lt;dbl&gt; 1.2433, 9.4267, -4.9500, 8.7767, -4.0333, 4.6600, 4.3800, 4.9~</span>
<span class="co">#&gt; $ ppt_djf  &lt;dbl&gt; 62.7257, 129.6406, 150.7003, 116.0236, 164.9327, 166.2220, 48~</span>
<span class="co">#&gt; $ ppt_jja  &lt;dbl&gt; 17.7941, 6.4317, 11.2294, 2.7020, 9.2686, 16.5310, 41.2494, 8~</span>
<span class="co">#&gt; $ pH       &lt;dbl&gt; 5.773341, 5.600000, 0.000000, 6.411796, 0.000000, 5.700000, 5~</span>
<span class="co">#&gt; $ awc      &lt;dbl&gt; 0.10837019, 0.16000000, 0.00000000, 0.09719457, 0.00000000, 0~</span>
<span class="co">#&gt; $ depth    &lt;dbl&gt; 152.000000, 201.000000, 0.000000, 59.759930, 0.000000, 112.99~</span>
<span class="co">#&gt; $ landform &lt;fct&gt; 7, 11, 15, 14, 15, 15, 7, 15, 4, 10, 6, 10, 10, 15, 10, 11, 1~</span>
<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">backg</span><span class="op">)</span>
<span class="co">#&gt; Rows: 5,000</span>
<span class="co">#&gt; Columns: 13</span>
<span class="co">#&gt; $ pr_ab        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ~</span>
<span class="co">#&gt; $ x            &lt;dbl&gt; 160779.16, 36849.16, -240170.84, -152420.84, -193190.84, ~</span>
<span class="co">#&gt; $ y            &lt;dbl&gt; -449968.33, 24151.67, 90031.67, -143518.33, 24151.67, 223~</span>
<span class="co">#&gt; $ aet          &lt;dbl&gt; 280.4567, 259.7800, 400.1767, 367.4833, 397.3667, 385.263~</span>
<span class="co">#&gt; $ cwd          &lt;dbl&gt; 1137.2433, 381.5367, 699.6500, 843.4467, 842.3833, 637.35~</span>
<span class="co">#&gt; $ tmin         &lt;dbl&gt; 13.5100, -3.1733, 8.6800, 9.0133, 8.9700, 4.9333, 6.2933,~</span>
<span class="co">#&gt; $ ppt_djf      &lt;dbl&gt; 71.2741, 171.4537, 285.0893, 72.0309, 125.2467, 226.1534,~</span>
<span class="co">#&gt; $ ppt_jja      &lt;dbl&gt; 1.1920, 17.5193, 5.0158, 1.2047, 1.9778, 8.1554, 18.4182,~</span>
<span class="co">#&gt; $ pH           &lt;dbl&gt; 0.0000000, 0.2122687, 5.7222223, 7.5350823, 6.1963525, 5.~</span>
<span class="co">#&gt; $ awc          &lt;dbl&gt; 0.000000000, 0.003473487, 0.080370426, 0.170000002, 0.131~</span>
<span class="co">#&gt; $ depth        &lt;dbl&gt; 0.00000, 201.00000, 50.07409, 154.39426, 122.39575, 56.17~</span>
<span class="co">#&gt; $ percent_clay &lt;dbl&gt; 0.0000000, 0.4438345, 18.4111176, 46.9751244, 37.1873169,~</span>
<span class="co">#&gt; $ landform     &lt;fct&gt; 13, 10, 6, 6, 10, 14, 8, 14, 6, 7, 11, 14, 14, 10, 6, 6, ~</span></code></pre></div>
<p>If you want to replace the abies dataset with your own data, make sure that your dataset contains the environmental conditions related to presence-absence data. We use a pre-modeling family function for a k-fold partition method (to be used for cross-validation). In the partition method the number of folds or replications must be the same for presence-absence and for background points datasets.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">abies2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/part_random.html">part_random</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">abies</span>,
  pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,
  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"kfold"</span>, folds <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">abies2</span><span class="op">)</span>
<span class="co">#&gt; Rows: 1,400</span>
<span class="co">#&gt; Columns: 14</span>
<span class="co">#&gt; $ id       &lt;int&gt; 715, 5680, 7907, 1850, 1702, 10036, 12384, 6513, 9884, 8651, ~</span>
<span class="co">#&gt; $ pr_ab    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~</span>
<span class="co">#&gt; $ x        &lt;dbl&gt; -95417.134, 98986.536, 121474.257, -39976.221, 111372.261, -2~</span>
<span class="co">#&gt; $ y        &lt;dbl&gt; 314240.13, -159415.18, -99463.44, -17456.11, -91404.05, 39222~</span>
<span class="co">#&gt; $ aet      &lt;dbl&gt; 323.1133, 447.5567, 182.2833, 372.3867, 209.4567, 308.3000, 5~</span>
<span class="co">#&gt; $ cwd      &lt;dbl&gt; 546.1400, 815.4033, 271.1800, 946.2933, 398.5500, 534.9533, 3~</span>
<span class="co">#&gt; $ tmin     &lt;dbl&gt; 1.2433, 9.4267, -4.9500, 8.7767, -4.0333, 4.6600, 4.3800, 4.9~</span>
<span class="co">#&gt; $ ppt_djf  &lt;dbl&gt; 62.7257, 129.6406, 150.7003, 116.0236, 164.9327, 166.2220, 48~</span>
<span class="co">#&gt; $ ppt_jja  &lt;dbl&gt; 17.7941, 6.4317, 11.2294, 2.7020, 9.2686, 16.5310, 41.2494, 8~</span>
<span class="co">#&gt; $ pH       &lt;dbl&gt; 5.773341, 5.600000, 0.000000, 6.411796, 0.000000, 5.700000, 5~</span>
<span class="co">#&gt; $ awc      &lt;dbl&gt; 0.10837019, 0.16000000, 0.00000000, 0.09719457, 0.00000000, 0~</span>
<span class="co">#&gt; $ depth    &lt;dbl&gt; 152.000000, 201.000000, 0.000000, 59.759930, 0.000000, 112.99~</span>
<span class="co">#&gt; $ landform &lt;fct&gt; 7, 11, 15, 14, 15, 15, 7, 15, 4, 10, 6, 10, 10, 15, 10, 11, 1~</span>
<span class="co">#&gt; $ .part    &lt;int&gt; 3, 3, 1, 2, 4, 5, 3, 1, 2, 1, 5, 1, 2, 2, 1, 5, 1, 2, 1, 3, 2~</span></code></pre></div>
<p>Now, in the abies2 object we have a new column called “.part” with the 5 k-folds (1, 2, 3, 4, 5), indicating which partition each record (row) is a member of. Next, we have to apply the same partition method and number of folds to the environmental conditions of the background points.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">backg2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/part_random.html">part_random</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">backg</span>,
  pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,
  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"kfold"</span>, folds <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">backg2</span><span class="op">)</span>
<span class="co">#&gt; Rows: 5,000</span>
<span class="co">#&gt; Columns: 14</span>
<span class="co">#&gt; $ pr_ab        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ~</span>
<span class="co">#&gt; $ x            &lt;dbl&gt; 160779.16, 36849.16, -240170.84, -152420.84, -193190.84, ~</span>
<span class="co">#&gt; $ y            &lt;dbl&gt; -449968.33, 24151.67, 90031.67, -143518.33, 24151.67, 223~</span>
<span class="co">#&gt; $ aet          &lt;dbl&gt; 280.4567, 259.7800, 400.1767, 367.4833, 397.3667, 385.263~</span>
<span class="co">#&gt; $ cwd          &lt;dbl&gt; 1137.2433, 381.5367, 699.6500, 843.4467, 842.3833, 637.35~</span>
<span class="co">#&gt; $ tmin         &lt;dbl&gt; 13.5100, -3.1733, 8.6800, 9.0133, 8.9700, 4.9333, 6.2933,~</span>
<span class="co">#&gt; $ ppt_djf      &lt;dbl&gt; 71.2741, 171.4537, 285.0893, 72.0309, 125.2467, 226.1534,~</span>
<span class="co">#&gt; $ ppt_jja      &lt;dbl&gt; 1.1920, 17.5193, 5.0158, 1.2047, 1.9778, 8.1554, 18.4182,~</span>
<span class="co">#&gt; $ pH           &lt;dbl&gt; 0.0000000, 0.2122687, 5.7222223, 7.5350823, 6.1963525, 5.~</span>
<span class="co">#&gt; $ awc          &lt;dbl&gt; 0.000000000, 0.003473487, 0.080370426, 0.170000002, 0.131~</span>
<span class="co">#&gt; $ depth        &lt;dbl&gt; 0.00000, 201.00000, 50.07409, 154.39426, 122.39575, 56.17~</span>
<span class="co">#&gt; $ percent_clay &lt;dbl&gt; 0.0000000, 0.4438345, 18.4111176, 46.9751244, 37.1873169,~</span>
<span class="co">#&gt; $ landform     &lt;fct&gt; 13, 10, 6, 6, 10, 14, 8, 14, 6, 7, 11, 14, 14, 10, 6, 6, ~</span>
<span class="co">#&gt; $ .part        &lt;int&gt; 2, 5, 4, 4, 3, 3, 4, 1, 1, 2, 4, 2, 5, 2, 1, 3, 1, 2, 1, ~</span></code></pre></div>
<p>In backg2 object we have a new column called “.part” with the 5 k-folds (1, 2, 3, 4, 5).</p>
<div id="fit-and-validate-models" class="section level3">
<h3 class="hasAnchor">
<a href="#fit-and-validate-models" class="anchor"></a>1. Fit and validate models</h3>
<p>We fit and validate models: I. a maximum entropy model with default hyper-parameter values (flexsdm::fit_max) and II. a random forest model with exploration of hyper-parameters (flexsdm::tune_raf).</p>
<p>I. Maximum Entropy models with default hyper-parameter values.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">max_t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_max.html">fit_max</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">abies2</span>,
  response <span class="op">=</span> <span class="st">"pr_ab"</span>,
  predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"aet"</span>, <span class="st">"ppt_jja"</span>, <span class="st">"pH"</span>, <span class="st">"awc"</span>, <span class="st">"depth"</span><span class="op">)</span>,
  predictors_f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"landform"</span><span class="op">)</span>,
  partition <span class="op">=</span> <span class="st">".part"</span>,
  background <span class="op">=</span> <span class="va">backg2</span>,
  thr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"max_sens_spec"</span>, <span class="st">"equal_sens_spec"</span>, <span class="st">"max_sorensen"</span><span class="op">)</span>,
  clamp <span class="op">=</span> <span class="cn">TRUE</span>,
  classes <span class="op">=</span> <span class="st">"default"</span>,
  pred_type <span class="op">=</span> <span class="st">"cloglog"</span>,
  regmult <span class="op">=</span> <span class="fl">1</span>
<span class="op">)</span>
<span class="co">#&gt; Formula used for model fitting:</span>
<span class="co">#&gt; ~aet + ppt_jja + pH + awc + depth + I(aet^2) + I(ppt_jja^2) + I(pH^2) + I(awc^2) + I(depth^2) + hinge(aet) + hinge(ppt_jja) + hinge(pH) + hinge(awc) + hinge(depth) + ppt_jja:aet + pH:aet + awc:aet + depth:aet + pH:ppt_jja + awc:ppt_jja + depth:ppt_jja + awc:pH + depth:pH + depth:awc - 1</span>
<span class="co">#&gt; Replica number: 1/1</span>
<span class="co">#&gt; Partition number: 1/5</span>
<span class="co">#&gt; Partition number: 2/5</span>
<span class="co">#&gt; Partition number: 3/5</span>
<span class="co">#&gt; Partition number: 4/5</span>
<span class="co">#&gt; Partition number: 5/5</span></code></pre></div>
<p>This function returns a list object with the following elements:</p>
<p>(I THINK YOU WANT TO RUN NAMES HERE) names(MAX_T1)</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>max.print <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>
<span class="va">max_t1</span><span class="op">$</span><span class="va">model</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:  glmnet::glmnet(x = mm, y = as.factor(p), family = "binomial",      weights = weights, lambda = 10^(seq(4, 0, length.out = 200)) *          sum(reg)/length(reg) * sum(p)/sum(weights), standardize = F,      penalty.factor = reg) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Df %Dev Lambda</span>
<span class="co">#&gt; 1    0 0.00 80.020</span>
<span class="co">#&gt; 2    0 0.00 76.400</span>
<span class="co">#&gt; 3    0 0.00 72.940</span>
<span class="co">#&gt; 4    0 0.00 69.640</span>
<span class="co">#&gt; 5    0 0.00 66.490</span>
<span class="co">#&gt; 6    0 0.00 63.490</span>
<span class="co">#&gt;  [ reached getOption("max.print") -- omitted 194 rows ]</span></code></pre></div>
<p>model: A “MaxEnt” class object. This object can be used for predicting. (I DO NOT THINK THE EXAMPLE SHOWN IS MAXENT. THIS IS A GLMNET) (ALSO YOU SHOULD PUT HTE DESCRIPTION OF EACH MODEL OBJECT ELEMENT BEFORE THE EXAMPLE NOT AFTER)</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">max_t1</span><span class="op">$</span><span class="va">predictors</span>
<span class="co">#&gt; # A tibble: 1 x 6</span>
<span class="co">#&gt;   c1    c2      c3    c4    c5    f       </span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   </span>
<span class="co">#&gt; 1 aet   ppt_jja pH    awc   depth landform</span></code></pre></div>
<p>predictors: A tibble with quantitative (c column names) and qualitative (f column names) variables use for modeling.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">max_t1</span><span class="op">$</span><span class="va">performance</span>
<span class="co">#&gt; # A tibble: 3 x 25</span>
<span class="co">#&gt;   model threshold      thr_value n_presences n_absences TPR_mean TPR_sd TNR_mean</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;              &lt;dbl&gt;       &lt;int&gt;      &lt;int&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 max   equal_sens_sp~     0.590         700        700    0.661 0.0314    0.664</span>
<span class="co">#&gt; 2 max   max_sens_spec      0.564         700        700    0.874 0.0736    0.539</span>
<span class="co">#&gt; 3 max   max_sorensen       0.529         700        700    0.93  0.0234    0.477</span>
<span class="co">#&gt; # ... with 17 more variables: TNR_sd &lt;dbl&gt;, SORENSEN_mean &lt;dbl&gt;,</span>
<span class="co">#&gt; #   SORENSEN_sd &lt;dbl&gt;, JACCARD_mean &lt;dbl&gt;, JACCARD_sd &lt;dbl&gt;, FPB_mean &lt;dbl&gt;,</span>
<span class="co">#&gt; #   FPB_sd &lt;dbl&gt;, OR_mean &lt;dbl&gt;, OR_sd &lt;dbl&gt;, TSS_mean &lt;dbl&gt;, TSS_sd &lt;dbl&gt;,</span>
<span class="co">#&gt; #   AUC_mean &lt;dbl&gt;, AUC_sd &lt;dbl&gt;, BOYCE_mean &lt;dbl&gt;, BOYCE_sd &lt;dbl&gt;,</span>
<span class="co">#&gt; #   IMAE_mean &lt;dbl&gt;, IMAE_sd &lt;dbl&gt;</span></code></pre></div>
<p>performance: The performance metric (see sdm_eval). Those metrics that are threshold dependent are calculated based on the threshold specified in the argument. We can see all the selected threshold values.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">max_t1</span><span class="op">$</span><span class="va">data_ens</span>
<span class="co">#&gt; # A tibble: 1,400 x 5</span>
<span class="co">#&gt;    rnames replicates part  pr_ab     pred</span>
<span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 3      .part      1         0 0.791   </span>
<span class="co">#&gt;  2 8      .part      1         0 0.675   </span>
<span class="co">#&gt;  3 10     .part      1         0 0.800   </span>
<span class="co">#&gt;  4 12     .part      1         0 0.350   </span>
<span class="co">#&gt;  5 15     .part      1         0 0.794   </span>
<span class="co">#&gt;  6 17     .part      1         0 0.595   </span>
<span class="co">#&gt;  7 19     .part      1         0 0.706   </span>
<span class="co">#&gt;  8 24     .part      1         0 0.881   </span>
<span class="co">#&gt;  9 29     .part      1         0 0.000754</span>
<span class="co">#&gt; 10 43     .part      1         0 0.921   </span>
<span class="co">#&gt; # ... with 1,390 more rows</span></code></pre></div>
<p>Predicted suitability and test partition for each observation (row).</p>
<p>II- Random forest models with exploration of hyper-parameters.</p>
<p>First, we create a data.frame that provides hyper-parameters values to be tested. It Is recommended to generate this data.frame. Hyper-parameter needed for tuning is ‘mtry’. The maximum mtry must be equal to total number of predictors.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tune_grid</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>mtry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We use the same data object abies2, with the same k-fold partition method:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rf_t</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/tune_raf.html">tune_raf</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">abies2</span>,
    response <span class="op">=</span> <span class="st">"pr_ab"</span>,
    predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>
      <span class="st">"aet"</span>, <span class="st">"cwd"</span>, <span class="st">"tmin"</span>, <span class="st">"ppt_djf"</span>,
      <span class="st">"ppt_jja"</span>, <span class="st">"pH"</span>, <span class="st">"awc"</span>, <span class="st">"depth"</span>
    <span class="op">)</span>,
    predictors_f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"landform"</span><span class="op">)</span>,
    partition <span class="op">=</span> <span class="st">".part"</span>,
    grid <span class="op">=</span> <span class="va">tune_grid</span>,
    thr <span class="op">=</span> <span class="st">"max_sens_spec"</span>,
    metric <span class="op">=</span> <span class="st">"TSS"</span>,
  <span class="op">)</span>
<span class="co">#&gt; Formula used for model fitting:</span>
<span class="co">#&gt; pr_ab ~ aet + cwd + tmin + ppt_djf + ppt_jja + pH + awc + depth + landform</span>
<span class="co">#&gt; Replica number: 1/1</span>
<span class="co">#&gt; Formula used for model fitting:</span>
<span class="co">#&gt; pr_ab ~ aet + cwd + tmin + ppt_djf + ppt_jja + pH + awc + depth + landform</span>
<span class="co">#&gt; Replica number: 1/1</span>
<span class="co">#&gt; Partition number: 1/5</span>
<span class="co">#&gt; Partition number: 2/5</span>
<span class="co">#&gt; Partition number: 3/5</span>
<span class="co">#&gt; Partition number: 4/5</span>
<span class="co">#&gt; Partition number: 5/5</span></code></pre></div>
<p>Let’s see what the output object contains. This function returns a list object with the following elements:</p>
<p>(I THINK YOU WANT TO RUN NAMES HERE) names(RF_T1)</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rf_t</span><span class="op">$</span><span class="va">model</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt;  randomForest(formula = formula1, data = data, mtry = mtry, ntree = 500,      importance = FALSE, ) </span>
<span class="co">#&gt;                Type of random forest: classification</span>
<span class="co">#&gt;                      Number of trees: 500</span>
<span class="co">#&gt; No. of variables tried at each split: 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;         OOB estimate of  error rate: 11.64%</span>
<span class="co">#&gt; Confusion matrix:</span>
<span class="co">#&gt;     0   1 class.error</span>
<span class="co">#&gt; 0 588 112  0.16000000</span>
<span class="co">#&gt; 1  51 649  0.07285714</span></code></pre></div>
<p>model: A “randomForest” class object. This object can be used to see the formula details, a basic summary o fthe model, and for predicting.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rf_t</span><span class="op">$</span><span class="va">predictors</span>
<span class="co">#&gt; # A tibble: 1 x 9</span>
<span class="co">#&gt;   c1    c2    c3    c4      c5      c6    c7    c8    f       </span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   </span>
<span class="co">#&gt; 1 aet   cwd   tmin  ppt_djf ppt_jja pH    awc   depth landform</span></code></pre></div>
<p>predictors: A tibble with quantitative (c column names) and qualitative (f column names) variables use for modeling.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rf_t</span><span class="op">$</span><span class="va">performance</span>
<span class="co">#&gt; # A tibble: 1 x 26</span>
<span class="co">#&gt;    mtry model threshold     thr_value n_presences n_absences TPR_mean TPR_sd</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;             &lt;dbl&gt;       &lt;int&gt;      &lt;int&gt;    &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1 raf   max_sens_spec     0.606         700        700    0.911 0.0415</span>
<span class="co">#&gt; # ... with 18 more variables: TNR_mean &lt;dbl&gt;, TNR_sd &lt;dbl&gt;,</span>
<span class="co">#&gt; #   SORENSEN_mean &lt;dbl&gt;, SORENSEN_sd &lt;dbl&gt;, JACCARD_mean &lt;dbl&gt;,</span>
<span class="co">#&gt; #   JACCARD_sd &lt;dbl&gt;, FPB_mean &lt;dbl&gt;, FPB_sd &lt;dbl&gt;, OR_mean &lt;dbl&gt;, OR_sd &lt;dbl&gt;,</span>
<span class="co">#&gt; #   TSS_mean &lt;dbl&gt;, TSS_sd &lt;dbl&gt;, AUC_mean &lt;dbl&gt;, AUC_sd &lt;dbl&gt;,</span>
<span class="co">#&gt; #   BOYCE_mean &lt;dbl&gt;, BOYCE_sd &lt;dbl&gt;, IMAE_mean &lt;dbl&gt;, IMAE_sd &lt;dbl&gt;</span></code></pre></div>
<p>performance: The performance metric (see sdm_eval). Those metrics that are threshold dependent are calculated based on the threshold specified in the argument. We can see all the selected threshold values.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rf_t</span><span class="op">$</span><span class="va">data_ens</span>
<span class="co">#&gt; # A tibble: 1,400 x 5</span>
<span class="co">#&gt;    rnames replicates part  pr_ab  pred</span>
<span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt; &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 3      .part      1     0     0.056</span>
<span class="co">#&gt;  2 8      .part      1     0     0.15 </span>
<span class="co">#&gt;  3 10     .part      1     0     0.156</span>
<span class="co">#&gt;  4 12     .part      1     0     0.376</span>
<span class="co">#&gt;  5 15     .part      1     0     0.182</span>
<span class="co">#&gt;  6 17     .part      1     0     0.126</span>
<span class="co">#&gt;  7 19     .part      1     0     0.126</span>
<span class="co">#&gt;  8 24     .part      1     0     0.866</span>
<span class="co">#&gt;  9 29     .part      1     0     0.016</span>
<span class="co">#&gt; 10 43     .part      1     0     0.862</span>
<span class="co">#&gt; # ... with 1,390 more rows</span></code></pre></div>
<p>Predicted suitability and test partition for each observation (row).</p>
<p>These model objects can be used in flexsdm::fit_ensemble().</p>
</div>
<div id="model-ensemble" class="section level3">
<h3 class="hasAnchor">
<a href="#model-ensemble" class="anchor"></a>2. Model Ensemble</h3>
<p>In this example we fit and validate and ensemble model using the two model objects that were just created.</p>
<p>(DO WE NEED TO SAY SOMETHING ABOUT THE NUMBER OF PARTITIONS CAN BE DIFFERENT THAN WHAT WAS USED FOR MODEL TUNING ABOVE?)</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># First we need this libraries</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra/">terra</a></span><span class="op">)</span>

<span class="co"># Environmental variables</span>
<span class="va">somevar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"external/somevar.tif"</span>, package <span class="op">=</span> <span class="st">"flexsdm"</span><span class="op">)</span>
<span class="va">somevar</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html">rast</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span>

<span class="co"># Species occurrences</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"spp"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">some_sp</span> <span class="op">&lt;-</span> <span class="va">spp</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"sp2"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/sdm_extract.html">sdm_extract</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">.</span>,
    x <span class="op">=</span> <span class="st">"x"</span>,
    y <span class="op">=</span> <span class="st">"y"</span>,
    env_layer <span class="op">=</span> <span class="va">somevar</span>,
    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/names.html">names</a></span><span class="op">(</span><span class="va">somevar</span><span class="op">)</span>,
    filter_na <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/part_random.html">part_random</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">.</span>,
    pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,
    method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"kfold"</span>, folds <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
  <span class="op">)</span>
<span class="co">#&gt; 6 rows were excluded from database because NAs were found</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit and validate ensemble model</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>mensemble <span class="ot">&lt;-</span> <span class="fu">fit_ensemble</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">models =</span> <span class="fu">list</span>(max_t1, rf_t),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ens_method =</span> <span class="st">"meansup"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">thr =</span> <span class="cn">NULL</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">thr_model =</span> <span class="st">"max_sens_spec"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"TSS"</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="er">|</span>                                                                      <span class="er">|</span>   <span class="dv">0</span>%</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================================================================|</span> <span class="dv">100</span>%</span></code></pre></div>
</div>
<div id="fit-and-validate-models-with-ensemble-of-small-model-approach" class="section level3">
<h3 class="hasAnchor">
<a href="#fit-and-validate-models-with-ensemble-of-small-model-approach" class="anchor"></a>3. Fit and validate models with Ensemble of Small Model approach</h3>
<p>This method consists of creating bivariate models with all pair-wise combinations of predictors and perform an ensemble based on the average of suitability weighted by Somers’ D metric (D = 2 x (AUC -0.5)). ESM is recommended for modeling species with very few occurrences. This function does not allow categorical variables because the use of these types of variables could be problematic when applied to species with few occurrences. For more detail see Breiner et al. (2015, 2018)</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"abies"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="co"># Create a smaller subset of occurrences</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="va">abies2</span> <span class="op">&lt;-</span> <span class="va">abies</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/na.omit.html">na.omit</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">pr_ab</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>We can use different methods in the flexsdm::part_random function according to our data. See <a href="https://sjevelazco.github.io/flexsdm/reference/part_random.html">part_random</a> for more details.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Using k-fold partition method for model cross validation</span>
<span class="va">abies2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/part_random.html">part_random</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">abies2</span>,
  pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,
  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"kfold"</span>, folds <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">abies2</span>
<span class="co">#&gt; # A tibble: 20 x 14</span>
<span class="co">#&gt;       id pr_ab        x        y   aet   cwd   tmin ppt_djf ppt_jja    pH    awc</span>
<span class="co">#&gt;    &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 12040     0 -308909.  384248.  573.  332.  4.84     521.   48.8   5.63 0.108 </span>
<span class="co">#&gt;  2 10361     0 -254286.  417158.  260.  469.  2.93     151.   15.1   6.20 0.0950</span>
<span class="co">#&gt;  3  9402     0 -286979.  386206.  587.  376.  6.45     333.   15.7   5.5  0.160 </span>
<span class="co">#&gt;  4  9815     0 -291849.  445595.  443.  455.  4.39     332.   19.1   6    0.0700</span>
<span class="co">#&gt;  5 10524     0 -256658.  184438.  355.  568.  5.87     303.   10.6   5.20 0.0800</span>
<span class="co">#&gt;  6  8860     0  121343. -164170.  354.  733.  3.97     182.    9.83  0    0     </span>
<span class="co">#&gt;  7  6431     0  107903. -122968.  461.  578.  4.87     161.    7.66  5.90 0.0900</span>
<span class="co">#&gt;  8 11730     0 -333903.  431238.  561.  364.  6.73     387.   25.2   5.80 0.130 </span>
<span class="co">#&gt;  9   808     0 -150163.  357180.  339.  564.  2.64     220.   15.3   6.40 0.100 </span>
<span class="co">#&gt; 10 11054     0 -293663.  340981.  477.  396.  3.89     332.   26.4   4.60 0.0634</span>
<span class="co">#&gt; 11  2960     1  -49273.  181752.  512.  275.  0.920    319.   17.3   5.92 0.0900</span>
<span class="co">#&gt; 12  3065     1  126907. -198892.  322.  544.  0.700    203.   10.6   5.60 0.110 </span>
<span class="co">#&gt; 13  5527     1  116751. -181089.  261.  537.  0.363    178.    7.43  0    0     </span>
<span class="co">#&gt; 14  4035     1  -31777.  115940.  394.  440.  2.07     298.   11.2   6.01 0.0769</span>
<span class="co">#&gt; 15  4081     1   -5158.   90159.  301.  502.  0.703    203.   14.6   6.11 0.0633</span>
<span class="co">#&gt; 16  3087     1  102151. -143976.  299.  425. -2.08     205.   13.4   3.88 0.110 </span>
<span class="co">#&gt; 17  3495     1  -19586.   89803.  438.  419.  2.13     189.   15.2   6.19 0.0959</span>
<span class="co">#&gt; 18  4441     1   49405.  -60502.  362.  582.  2.42     218.    7.84  5.64 0.0786</span>
<span class="co">#&gt; 19   301     1 -132516.  270845.  367.  196. -2.56     422.   26.3   6.70 0.0300</span>
<span class="co">#&gt; 20  3162     1   59905.  -53634.  319.  626.  1.99     212.    4.50  4.51 0.0396</span>
<span class="co">#&gt; # ... with 3 more variables: depth &lt;dbl&gt;, landform &lt;fct&gt;, .part &lt;int&gt;</span></code></pre></div>
<p>This function constructs Generalized Additive Models using the Ensembles of Small Models (ESM) approach (Breiner et al., 2015, 2018).</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># We set the model without threshold specification and with the kfold created above</span>
<span class="va">esm_gam_t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/esm_gam.html">esm_gam</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">abies2</span>,
  response <span class="op">=</span> <span class="st">"pr_ab"</span>,
  predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"aet"</span>, <span class="st">"cwd"</span>, <span class="st">"tmin"</span>, <span class="st">"ppt_djf"</span>, <span class="st">"ppt_jja"</span>, <span class="st">"pH"</span>, <span class="st">"awc"</span>, <span class="st">"depth"</span><span class="op">)</span>,
  partition <span class="op">=</span> <span class="st">".part"</span>,
  thr <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model has more coefficients than data used for training it. Try to reduce k</span></code></pre></div>
<p>This function returns a list object with the following elements:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/terra/man/names.html">names</a></span><span class="op">(</span><span class="va">esm_gam_t1</span><span class="op">)</span>
<span class="co">#&gt; NULL</span></code></pre></div>
<p>esm_model: A list with “GAM” class object for each bivariate model. This object can be used for predicting using the ESM approachwith sdm_predict function.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>max.print <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># If you don't want to see printed all the output</span>
<span class="va">esm_gam_t1</span><span class="op">$</span><span class="va">esm_model</span>
<span class="co">#&gt; NULL</span></code></pre></div>
<p>predictors: A tibble with variables use for modeling.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">esm_gam_t1</span><span class="op">$</span><span class="va">predictors</span>
<span class="co">#&gt; NULL</span></code></pre></div>
<p>performance: Performance metric (see sdm_eval). Those threshold dependent metrics are calculated based on the threshold specified in the argument.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">esm_gam_t1</span><span class="op">$</span><span class="va">performance</span>
<span class="co">#&gt; NULL</span></code></pre></div>
<p>Now, we test the rep_kfold partition method. In this method ‘folds’ refers to the number of partitions for data partitioning and ‘replicate’ refers to the number of replicates. Both assume values &gt;=1.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Remove the previous k-fold partition</span>
<span class="va">abies2</span> <span class="op">&lt;-</span> <span class="va">abies2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"."</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Test with rep_kfold partition using 3 folds and 5 replicates</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="va">abies2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/part_random.html">part_random</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">abies2</span>,
  pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,
  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"rep_kfold"</span>, folds <span class="op">=</span> <span class="fl">3</span>, replicates <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">abies2</span>
<span class="co">#&gt; # A tibble: 20 x 18</span>
<span class="co">#&gt;       id pr_ab        x        y   aet   cwd   tmin ppt_djf ppt_jja    pH    awc</span>
<span class="co">#&gt;    &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 12040     0 -308909.  384248.  573.  332.  4.84     521.   48.8   5.63 0.108 </span>
<span class="co">#&gt;  2 10361     0 -254286.  417158.  260.  469.  2.93     151.   15.1   6.20 0.0950</span>
<span class="co">#&gt;  3  9402     0 -286979.  386206.  587.  376.  6.45     333.   15.7   5.5  0.160 </span>
<span class="co">#&gt;  4  9815     0 -291849.  445595.  443.  455.  4.39     332.   19.1   6    0.0700</span>
<span class="co">#&gt;  5 10524     0 -256658.  184438.  355.  568.  5.87     303.   10.6   5.20 0.0800</span>
<span class="co">#&gt;  6  8860     0  121343. -164170.  354.  733.  3.97     182.    9.83  0    0     </span>
<span class="co">#&gt;  7  6431     0  107903. -122968.  461.  578.  4.87     161.    7.66  5.90 0.0900</span>
<span class="co">#&gt;  8 11730     0 -333903.  431238.  561.  364.  6.73     387.   25.2   5.80 0.130 </span>
<span class="co">#&gt;  9   808     0 -150163.  357180.  339.  564.  2.64     220.   15.3   6.40 0.100 </span>
<span class="co">#&gt; 10 11054     0 -293663.  340981.  477.  396.  3.89     332.   26.4   4.60 0.0634</span>
<span class="co">#&gt; 11  2960     1  -49273.  181752.  512.  275.  0.920    319.   17.3   5.92 0.0900</span>
<span class="co">#&gt; 12  3065     1  126907. -198892.  322.  544.  0.700    203.   10.6   5.60 0.110 </span>
<span class="co">#&gt; 13  5527     1  116751. -181089.  261.  537.  0.363    178.    7.43  0    0     </span>
<span class="co">#&gt; 14  4035     1  -31777.  115940.  394.  440.  2.07     298.   11.2   6.01 0.0769</span>
<span class="co">#&gt; 15  4081     1   -5158.   90159.  301.  502.  0.703    203.   14.6   6.11 0.0633</span>
<span class="co">#&gt; 16  3087     1  102151. -143976.  299.  425. -2.08     205.   13.4   3.88 0.110 </span>
<span class="co">#&gt; 17  3495     1  -19586.   89803.  438.  419.  2.13     189.   15.2   6.19 0.0959</span>
<span class="co">#&gt; 18  4441     1   49405.  -60502.  362.  582.  2.42     218.    7.84  5.64 0.0786</span>
<span class="co">#&gt; 19   301     1 -132516.  270845.  367.  196. -2.56     422.   26.3   6.70 0.0300</span>
<span class="co">#&gt; 20  3162     1   59905.  -53634.  319.  626.  1.99     212.    4.50  4.51 0.0396</span>
<span class="co">#&gt; # ... with 7 more variables: depth &lt;dbl&gt;, landform &lt;fct&gt;, .part1 &lt;int&gt;,</span>
<span class="co">#&gt; #   .part2 &lt;int&gt;, .part3 &lt;int&gt;, .part4 &lt;int&gt;, .part5 &lt;int&gt;</span></code></pre></div>
<p>We use the new rep_kfold partition in the gam model</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">esm_gam_t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/esm_gam.html">esm_gam</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">abies2</span>,
  response <span class="op">=</span> <span class="st">"pr_ab"</span>,
  predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"aet"</span>, <span class="st">"cwd"</span>, <span class="st">"tmin"</span>, <span class="st">"ppt_djf"</span>, <span class="st">"ppt_jja"</span>, <span class="st">"pH"</span>, <span class="st">"awc"</span>, <span class="st">"depth"</span><span class="op">)</span>,
  partition <span class="op">=</span> <span class="st">".part"</span>,
  thr <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model has more coefficients than data used for training it. Try to reduce k</span></code></pre></div>
<p>Test with random bootstrap partitioning. In method ‘replicate’ refers to the number of replicates (assumes a value &gt;=1), ‘proportion’ refers to the proportion of occurrences used for model fitting (assumes a value &gt;0 and &lt;=1). With this method we can configure the proportion of training and testing data according to the species occurrences. In this example, proportion=‘0.7’ indicates that 70% of data will be used for model training, while 30% will be used for model testing. For this method, the function will return .partX columns with “train” or “test” words as the entries.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Remove the previous k-fold partition</span>
<span class="va">abies2</span> <span class="op">&lt;-</span> <span class="va">abies2</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"."</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Test with bootstrap partition using 10 replicates</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="va">abies2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/part_random.html">part_random</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">abies2</span>,
  pr_ab <span class="op">=</span> <span class="st">"pr_ab"</span>,
  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"boot"</span>, replicates <span class="op">=</span> <span class="fl">10</span>, proportion <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">abies2</span>
<span class="co">#&gt; # A tibble: 20 x 23</span>
<span class="co">#&gt;       id pr_ab        x        y   aet   cwd   tmin ppt_djf ppt_jja    pH    awc</span>
<span class="co">#&gt;    &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 12040     0 -308909.  384248.  573.  332.  4.84     521.   48.8   5.63 0.108 </span>
<span class="co">#&gt;  2 10361     0 -254286.  417158.  260.  469.  2.93     151.   15.1   6.20 0.0950</span>
<span class="co">#&gt;  3  9402     0 -286979.  386206.  587.  376.  6.45     333.   15.7   5.5  0.160 </span>
<span class="co">#&gt;  4  9815     0 -291849.  445595.  443.  455.  4.39     332.   19.1   6    0.0700</span>
<span class="co">#&gt;  5 10524     0 -256658.  184438.  355.  568.  5.87     303.   10.6   5.20 0.0800</span>
<span class="co">#&gt;  6  8860     0  121343. -164170.  354.  733.  3.97     182.    9.83  0    0     </span>
<span class="co">#&gt;  7  6431     0  107903. -122968.  461.  578.  4.87     161.    7.66  5.90 0.0900</span>
<span class="co">#&gt;  8 11730     0 -333903.  431238.  561.  364.  6.73     387.   25.2   5.80 0.130 </span>
<span class="co">#&gt;  9   808     0 -150163.  357180.  339.  564.  2.64     220.   15.3   6.40 0.100 </span>
<span class="co">#&gt; 10 11054     0 -293663.  340981.  477.  396.  3.89     332.   26.4   4.60 0.0634</span>
<span class="co">#&gt; 11  2960     1  -49273.  181752.  512.  275.  0.920    319.   17.3   5.92 0.0900</span>
<span class="co">#&gt; 12  3065     1  126907. -198892.  322.  544.  0.700    203.   10.6   5.60 0.110 </span>
<span class="co">#&gt; 13  5527     1  116751. -181089.  261.  537.  0.363    178.    7.43  0    0     </span>
<span class="co">#&gt; 14  4035     1  -31777.  115940.  394.  440.  2.07     298.   11.2   6.01 0.0769</span>
<span class="co">#&gt; 15  4081     1   -5158.   90159.  301.  502.  0.703    203.   14.6   6.11 0.0633</span>
<span class="co">#&gt; 16  3087     1  102151. -143976.  299.  425. -2.08     205.   13.4   3.88 0.110 </span>
<span class="co">#&gt; 17  3495     1  -19586.   89803.  438.  419.  2.13     189.   15.2   6.19 0.0959</span>
<span class="co">#&gt; 18  4441     1   49405.  -60502.  362.  582.  2.42     218.    7.84  5.64 0.0786</span>
<span class="co">#&gt; 19   301     1 -132516.  270845.  367.  196. -2.56     422.   26.3   6.70 0.0300</span>
<span class="co">#&gt; 20  3162     1   59905.  -53634.  319.  626.  1.99     212.    4.50  4.51 0.0396</span>
<span class="co">#&gt; # ... with 12 more variables: depth &lt;dbl&gt;, landform &lt;fct&gt;, .part1 &lt;chr&gt;,</span>
<span class="co">#&gt; #   .part2 &lt;chr&gt;, .part3 &lt;chr&gt;, .part4 &lt;chr&gt;, .part5 &lt;chr&gt;, .part6 &lt;chr&gt;,</span>
<span class="co">#&gt; #   .part7 &lt;chr&gt;, .part8 &lt;chr&gt;, .part9 &lt;chr&gt;, .part10 &lt;chr&gt;</span></code></pre></div>
<p>Use the new rep_kfold partition in the gam model</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">esm_gam_t3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/esm_gam.html">esm_gam</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">abies2</span>,
  response <span class="op">=</span> <span class="st">"pr_ab"</span>,
  predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"aet"</span>, <span class="st">"cwd"</span>, <span class="st">"tmin"</span>, <span class="st">"ppt_djf"</span>, <span class="st">"ppt_jja"</span>, <span class="st">"pH"</span>, <span class="st">"awc"</span>, <span class="st">"depth"</span><span class="op">)</span>,
  partition <span class="op">=</span> <span class="st">".part"</span>,
  thr <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model has more coefficients than data used for training it. Try to reduce k</span></code></pre></div>
<p>#=========#=========#=========#=========#=========#=========#=========#</p>
<p><strong>Vignette still under construction and changes</strong></p>
<p>#=========#=========#=========#=========#=========#=========#=========#</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Santiago J.E. Velazco, Brooke Rose, André F.A. Andrade, Ignacio Minoli, Janet Franklin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
